<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>手機 VR：儲值卡 vs 信用卡（流程走一趟）</title>

  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>

  <style>
    html, body { margin:0; height:100%; background:#000; font-family: system-ui, -apple-system, "Noto Sans TC", sans-serif; }
    #hud{
      position: fixed; left:0; right:0; bottom:0;
      background: rgba(0,0,0,.65); color:#fff;
      padding: 10px 12px; z-index: 999;
      font-size: 14px; line-height: 1.35;
      backdrop-filter: blur(4px);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center;}
    .pill{border:1px solid rgba(255,255,255,.25); border-radius:999px; padding:2px 10px; font-size:12px; opacity:.95;}
  </style>
</head>

<body>
  <div id="hud">
    <div class="row">
      <div class="pill">操作：凝視 1.2 秒 / 點擊</div>
      <div class="pill" id="modePill">模式：未選擇流程</div>
      <div class="pill" id="progPill">進度：—</div>
    </div>
    <div style="margin-top:6px"><b>提示：</b><span id="hintText">請看「入口牌」選擇流程</span></div>
  </div>

  <a-scene background="color:#0b0f1a" vr-mode-ui="enabled:true" device-orientation-permission-ui="enabled:true">
    <!-- lights -->
    <a-entity light="type:ambient; intensity:0.65"></a-entity>
    <a-entity light="type:directional; intensity:0.9" position="1 3 2"></a-entity>

    <!-- floor -->
    <a-plane rotation="-90 0 0" width="30" height="30" color="#1f2433"></a-plane>

    <!-- camera + cursor (gaze) -->
    <a-entity position="0 1.6 6">
      <a-camera wasd-controls-enabled="false">
        <a-cursor fuse="true" fuseTimeout="1200" raycaster="objects: .interactable"></a-cursor>
      </a-camera>
    </a-entity>

    <!-- ===== ENTRANCE ===== -->
    <a-entity position="0 1.6 -1.5">
      <!-- prepaid -->
      <a-box id="choosePrepaid" class="interactable" position="-1.7 0 0" width="1.6" height="1" depth="0.18" color="#2b7a78"></a-box>
      <a-text value="儲值卡流程" align="center" color="#fff" width="6" position="-1.7 0.1 0.25"></a-text>
      <a-text value="先儲值 → 再消費" align="center" color="#d7fffe" width="6" position="-1.7 -0.35 0.25"></a-text>

      <!-- credit -->
      <a-box id="chooseCredit" class="interactable" position="1.7 0 0" width="1.6" height="1" depth="0.18" color="#3b5bdb"></a-box>
      <a-text value="信用卡流程" align="center" color="#fff" width="6" position="1.7 0.1 0.25"></a-text>
      <a-text value="先消費 → 後繳款" align="center" color="#dbe7ff" width="6" position="1.7 -0.35 0.25"></a-text>

      <a-text value="請選擇一條流程" align="center" color="#ffffff" width="10" position="0 1.1 0"></a-text>
    </a-entity>

    <!-- ===== PREPAID STATIONS (left lane) ===== -->
    <a-entity position="-4 0 -4">
      <a-text value="儲值卡（預付）" align="center" color="#9ff5f2" width="10" position="0 2.4 0"></a-text>

      <a-box id="p1" class="interactable" position="0 1 0" width="1.8" height="1.1" depth="0.6" color="#2b7a78"></a-box>
      <a-text value="① 儲值" align="center" color="#fff" width="6" position="0 1.75 0.45"></a-text>
      <a-text value="先把錢存進卡裡" align="center" color="#e9fffe" width="6" position="0 1.35 0.45"></a-text>

      <a-box id="p2" class="interactable" position="0 1 -3.2" width="1.8" height="1.1" depth="0.6" color="#2b7a78"></a-box>
      <a-text value="② 消費" align="center" color="#fff" width="6" position="0 1.75 -2.75"></a-text>
      <a-text value="扣卡內餘額" align="center" color="#e9fffe" width="6" position="0 1.35 -2.75"></a-text>

      <a-box id="p3" class="interactable" position="0 1 -6.4" width="1.8" height="1.1" depth="0.6" color="#2b7a78"></a-box>
      <a-text value="③ 完成" align="center" color="#fff" width="6" position="0 1.75 -5.95"></a-text>
      <a-text value="交易完成：餘額變少" align="center" color="#e9fffe" width="8" position="0 1.35 -5.95"></a-text>
    </a-entity>

    <!-- ===== CREDIT STATIONS (right lane) ===== -->
    <a-entity position="4 0 -4">
      <a-text value="信用卡（延後給付）" align="center" color="#b8c7ff" width="12" position="0 2.4 0"></a-text>

      <a-box id="c1" class="interactable" position="0 1 0" width="1.8" height="1.1" depth="0.6" color="#3b5bdb"></a-box>
      <a-text value="① 消費" align="center" color="#fff" width="6" position="0 1.75 0.45"></a-text>
      <a-text value="先拿到商品" align="center" color="#eef1ff" width="6" position="0 1.35 0.45"></a-text>

      <a-box id="c2" class="interactable" position="0 1 -3.2" width="1.8" height="1.1" depth="0.6" color="#3b5bdb"></a-box>
      <a-text value="② 銀行先墊款" align="center" color="#fff" width="10" position="0 1.75 -2.75"></a-text>
      <a-text value="銀行先付給商店" align="center" color="#eef1ff" width="8" position="0 1.35 -2.75"></a-text>

      <a-box id="c3" class="interactable" position="0 1 -6.4" width="1.8" height="1.1" depth="0.6" color="#3b5bdb"></a-box>
      <a-text value="③ 繳款" align="center" color="#fff" width="6" position="0 1.75 -5.95"></a-text>
      <a-text value="月底帳單→付銀行" align="center" color="#eef1ff" width="10" position="0 1.35 -5.95"></a-text>
    </a-entity>

    <!-- hover feedback -->
    <a-entity id="hoverHint" position="0 2.8 2">
      <a-text id="hoverText" value="" align="center" color="#ffffff" width="10"></a-text>
    </a-entity>

    <a-sky color="#0b0f1a"></a-sky>

    <script>
      // ====== HUD ======
      const modePill = document.getElementById('modePill');
      const progPill = document.getElementById('progPill');
      const hintText = document.getElementById('hintText');
      const hoverText = document.getElementById('hoverText');

      // ====== state machine ======
      const state = { flow: null, step: 0, max: 3 };

      const FLOW = {
        prepaid: { order: ['p1','p2','p3'], label: '儲值卡流程', hint: '請依序：①儲值 → ②消費 → ③完成' },
        credit:  { order: ['c1','c2','c3'], label: '信用卡流程', hint: '請依序：①消費 → ②銀行先墊款 → ③繳款' }
      };

      function setMode(text){ modePill.textContent = '模式：' + text; }
      function setProg(text){ progPill.textContent = '進度：' + text; }
      function setHint(text){ hintText.textContent = text; }

      function reset(flow){
        state.flow = flow;
        state.step = 0;
        setMode(FLOW[flow].label);
        setProg('0/3');
        setHint(FLOW[flow].hint);
      }

      function touchStation(id){
        if(!state.flow){
          setHint('你還沒選流程：請先看入口牌選「儲值卡」或「信用卡」。');
          return;
        }
        const seq = FLOW[state.flow].order;
        const expectedId = seq[state.step];

        // wrong lane
        const isOtherLane = !seq.includes(id);
        if(isOtherLane){
          setHint('你點到另一條流程的站點了。請回到你選的流程走完。');
          return;
        }

        // wrong order
        if(id !== expectedId){
          setHint(`順序不對！現在應該做：${state.step+1} / 3`);
          setProg(`${state.step}/3`);
          return;
        }

        // correct
        state.step += 1;
        setProg(`${state.step}/3`);

        if(state.step >= state.max){
          setHint(state.flow === 'prepaid'
            ? '✅ 完成！儲值卡＝先儲值（預付）→再消費（扣餘額）。你可以回入口改選信用卡比較。'
            : '✅ 完成！信用卡＝先消費→銀行先墊款→你之後繳款（延後給付）。你可以回入口改選儲值卡比較。'
          );
        }else{
          setHint('✅ 正確！請前往下一站。');
        }
      }

      // bind interactables
      document.querySelectorAll('.interactable').forEach(el=>{
        el.addEventListener('click', ()=>{
          const id = el.id;
          if(id === 'choosePrepaid') return reset('prepaid');
          if(id === 'chooseCredit')  return reset('credit');
          return touchStation(id);
        });

        el.addEventListener('mouseenter', ()=>{
          el.setAttribute('scale','1.08 1.08 1.08');
          hoverText.setAttribute('value', el.id || '');
        });
        el.addEventListener('mouseleave', ()=>{
          el.setAttribute('scale','1 1 1');
          hoverText.setAttribute('value','');
        });
      });

      // init
      setMode('未選擇流程');
      setProg('—');
      setHint('請看「入口牌」選擇流程（凝視 1.2 秒或點一下）。');
    </script>
  </a-scene>
</body>
</html>
