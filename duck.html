<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>2D æ‰“é³¥å­¸æµç¨‹ï¼šå„²å€¼å¡ vs ä¿¡ç”¨å¡ï¼ˆç´ é¤Šå°å‘ï¼‰</title>
  <style>
    :root{
      --bg:#061018;
      --panel:rgba(0,0,0,.55);
      --panel2:rgba(255,255,255,.06);
      --line:rgba(255,255,255,.14);
      --txt:#eaf2ff;
      --muted:#b7c3da;
      --good:#42d08a;
      --bad:#ff6b6a;
      --warn:#ffd66a;
      --accent:#6aa9ff;
      --accent2:#9cffd9;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
    }

    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,"Noto Sans TC","Segoe UI",Roboto,Arial;}
    #wrap{height:100%;display:grid;grid-template-rows:auto auto 1fr auto;gap:10px;}

    header{
      display:flex; flex-wrap:wrap; gap:10px; align-items:center;
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    }
    header .title{font-weight:800; letter-spacing:.4px;}
    header .pill{
      padding:4px 10px; border-radius:999px;
      border:1px solid var(--line); background:var(--panel2);
      font-size:12px; color:var(--muted); white-space:nowrap;
    }
    header .spacer{flex:1;}
    header .ctrl{display:flex; gap:10px; align-items:center; flex-wrap:wrap;}
    label{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:8px;}
    input[type="range"]{width:160px;}
    select, button{
      background:var(--panel2);
      color:var(--txt);
      border:1px solid var(--line);
      border-radius:10px;
      padding:8px 10px;
      cursor:pointer;
    }
    button{font-weight:700;}
    button.primary{border-color:rgba(106,169,255,.6); background:rgba(106,169,255,.15);}
    button.warn{border-color:rgba(255,214,106,.65); background:rgba(255,214,106,.12);}

    #qpanel{
      margin:0 14px;
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:12px 12px 10px 12px;
    }
    #qpanel .row{
      display:flex; gap:10px; align-items:flex-start; flex-wrap:wrap;
    }
    #qpanel .qtitle{
      font-weight:800; font-size:14px; color:#dfe9ff;
    }
    #qpanel .qtext{
      font-size:15px; line-height:1.45; color:#f3f7ff;
      margin-top:6px;
    }
    #qpanel .meta{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
      display:flex; gap:10px; flex-wrap:wrap;
    }
    .tag{
      border:1px solid var(--line);
      background:var(--panel2);
      padding:3px 8px;
      border-radius:999px;
    }

    #game{
      position:relative;
      margin:0 14px;
      border-radius:18px;
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
      background:
        radial-gradient(1200px 700px at 50% 120%, rgba(106,169,255,.18), transparent 60%),
        radial-gradient(900px 600px at 18% 20%, rgba(156,255,217,.10), transparent 55%),
        radial-gradient(900px 700px at 82% 16%, rgba(255,214,106,.08), transparent 55%),
        var(--bg);
      box-shadow:var(--shadow);
      cursor:crosshair;
      user-select:none;
      touch-action:manipulation;
      min-height:420px;
    }

    /* bottom HUD */
    #hud{
      margin:0 14px 14px 14px;
      border:1px solid var(--line);
      background:var(--panel);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:10px 12px;
      display:grid;
      grid-template-columns: 1fr auto;
      gap:10px;
      align-items:center;
    }
    #msg{
      font-size:13px; color:#f0f6ff; line-height:1.35;
    }
    #msg b{color:#fff;}
    #msg .good{color:var(--good);font-weight:800;}
    #msg .bad{color:var(--bad);font-weight:800;}
    #msg .warn{color:var(--warn);font-weight:800;}
    #mini{
      display:flex; gap:10px; flex-wrap:wrap; justify-content:flex-end;
      font-size:12px; color:var(--muted);
    }
    #mini .m{padding:3px 8px;border-radius:999px;border:1px solid var(--line);background:var(--panel2);}

    /* comparison card */
    #compare{
      position:absolute;
      inset:auto 18px 18px 18px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.62);
      border-radius:16px;
      box-shadow:var(--shadow);
      padding:12px 12px 10px 12px;
      backdrop-filter: blur(6px);
      display:none;
    }
    #compare .headline{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
      font-weight:900;
      color:#f7fbff;
      letter-spacing:.2px;
    }
    #compare .headline .chip{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(255,255,255,.06);
      font-size:12px;
      font-weight:800;
      color:var(--muted);
    }
    #compare .oneLine{
      margin-top:8px;
      font-size:14px;
      line-height:1.45;
      color:#f2f7ff;
    }
    #compare table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      margin-top:10px;
      font-size:13px;
      overflow:hidden;
      border-radius:12px;
      border:1px solid rgba(255,255,255,.12);
    }
    #compare th, #compare td{
      padding:8px 10px;
      border-bottom:1px solid rgba(255,255,255,.10);
      vertical-align:top;
    }
    #compare th{
      background:rgba(255,255,255,.06);
      color:#eaf2ff;
      text-align:left;
      width:120px;
      white-space:nowrap;
    }
    #compare tr:last-child td, #compare tr:last-child th{border-bottom:none;}
    #compare .hint{
      margin-top:8px;
      color:var(--muted);
      font-size:12px;
    }

    /* bird */
    .bird{
      position:absolute;
      width:180px;
      height:56px;
      display:flex;
      align-items:center;
      gap:10px;
      padding:8px 10px 8px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.35);
      box-shadow: 0 8px 24px rgba(0,0,0,.25);
      backdrop-filter: blur(3px);
      transform: translate3d(0,0,0);
      will-change: transform;
    }
    .bird:hover{border-color:rgba(255,255,255,.35);}
    .bird .icon{
      width:36px; height:36px;
      flex:0 0 auto;
      display:grid; place-items:center;
      border-radius:10px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
    }
    .bird .txt{min-width:0;}
    .bird .txt .top{
      font-weight:900;
      font-size:13px;
      line-height:1.1;
      color:#f7fbff;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .bird .txt .sub{
      margin-top:4px;
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }

    .bird.good{border-color:rgba(66,208,138,.55);}
    .bird.bad{border-color:rgba(255,107,106,.55);}
    .bird.neutral{border-color:rgba(255,214,106,.55);}

    /* countdown overlay */
    #overlay{
      position:absolute; inset:0;
      display:none;
      align-items:center; justify-content:center;
      background:rgba(0,0,0,.35);
      backdrop-filter: blur(2px);
    }
    #overlay .card{
      width:min(520px, calc(100% - 36px));
      border-radius:18px;
      border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.60);
      box-shadow:var(--shadow);
      padding:14px 14px 12px 14px;
    }
    #overlay .card .big{
      font-weight:1000;
      font-size:18px;
      line-height:1.35;
    }
    #overlay .card .small{
      margin-top:8px;
      color:var(--muted);
      font-size:13px;
      line-height:1.45;
    }
    #overlay .count{
      margin-top:10px;
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      color:var(--muted);
    }
    .bar{
      height:8px; flex:1;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      overflow:hidden;
    }
    .bar > i{
      display:block; height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(106,169,255,.9), rgba(156,255,217,.9));
    }

    @media (max-width: 520px){
      .bird{width:160px;}
      input[type="range"]{width:120px;}
    }
  </style>
</head>
<body>
<div id="wrap">
  <header>
    <div class="title">2D æ‰“é³¥å­¸æµç¨‹ï¼š<span style="color:var(--accent2)">å„²å€¼å¡</span> vs <span style="color:var(--accent)">ä¿¡ç”¨å¡</span></div>
    <div class="pill" id="statScore">åˆ†æ•¸ï¼š0</div>
    <div class="pill" id="statStreak">é€£å°ï¼š0</div>
    <div class="pill" id="statQ">é¡Œè™Ÿï¼š0/0</div>
    <div class="spacer"></div>
    <div class="ctrl">
      <label>é€Ÿåº¦
        <input id="speed" type="range" min="0.5" max="2.2" step="0.05" value="1.0" />
      </label>
      <label>é›£åº¦
        <select id="difficulty">
          <option value="easy">ç°¡å–®</option>
          <option value="normal" selected>ä¸€èˆ¬</option>
          <option value="hard">å›°é›£</option>
        </select>
      </label>
      <button class="primary" id="btnStart">é–‹å§‹ / ä¸‹ä¸€é¡Œ</button>
      <button class="warn" id="btnReset">é‡ä¾†</button>
    </div>
  </header>

  <section id="qpanel">
    <div class="row">
      <div style="flex:1;min-width:240px;">
        <div class="qtitle" id="qtitle">é¡Œç›®ï¼ˆå…ˆçœ‹ 5 ç§’å†é–‹å§‹æ‰“é³¥ï¼‰</div>
        <div class="qtext" id="qtext">æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚</div>
        <div class="meta">
          <span class="tag" id="tagFocus">ç„¦é»ï¼šâ€”</span>
          <span class="tag" id="tagTrap">å¸¸è¦‹èª¤å€ï¼šâ€”</span>
          <span class="tag" id="tagKey">é—œéµç·šç´¢ï¼šâ€”</span>
        </div>
      </div>
    </div>
  </section>

  <main id="game" aria-label="game">
    <div id="overlay">
      <div class="card">
        <div class="big" id="ovTitle">ğŸ“Œ å…ˆè®€é¡Œç›®</div>
        <div class="small" id="ovText">çœ‹æ¸…æ¥šæƒ…å¢ƒï¼šèª°æ‰¿æ“”é¢¨éšªï¼Ÿèƒ½ä¸èƒ½è¶…æ”¯ï¼Ÿæœ‰æ²’æœ‰æ¶ˆè²»ä¿éšœï¼Ÿ</div>
        <div class="count">
          <span id="ovCount">5 ç§’å¾Œé–‹å§‹</span>
          <div class="bar"><i id="ovBar"></i></div>
        </div>
      </div>
    </div>

    <div id="compare">
      <div class="headline">
        <span id="cmpResult">âœ…</span>
        <span id="cmpHeadline">æœ¬é¡Œé‡é»æ¯”è¼ƒ</span>
        <span class="chip" id="cmpChip">â€”</span>
      </div>
      <div class="oneLine" id="cmpOneLine">â€”</div>
      <table>
        <tr>
          <th>å„²å€¼å¡</th>
          <td id="cmpPrepaid">â€”</td>
        </tr>
        <tr>
          <th>ä¿¡ç”¨å¡</th>
          <td id="cmpCredit">â€”</td>
        </tr>
      </table>
      <div class="hint" id="cmpHint">æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é€²ä¸‹ä¸€é¡Œã€‚</div>
    </div>
  </main>

  <footer id="hud">
    <div id="msg">
      <span class="warn">æç¤ºï¼š</span>é€™ä¸æ˜¯æ¯”æ‰‹å¿«ï¼Œæ˜¯æ¯”ä½ èƒ½ä¸èƒ½æŠŠã€Œæƒ…å¢ƒã€å°ä¸Šã€Œå·¥å…·ç‰¹æ€§ã€ã€‚
    </div>
    <div id="mini">
      <div class="m">é»æ“Šé³¥ = ä½œç­”</div>
      <div class="m">å…ˆè®€é¡Œ 5 ç§’</div>
      <div class="m">é³¥æœƒä¸€ç›´ç§»å‹•</div>
    </div>
  </footer>
</div>

<script>
(() => {
  // ====== é¡Œåº«ï¼ˆç´ é¤Šå°å‘ï¼‰ ======
  // focus: æœ¬é¡Œè¦ç·´ä»€éº¼åˆ¤æ–·
  // trap: å¸¸è¦‹èª¤å€
  // key: çœ‹åˆ°ä»€éº¼ç·šç´¢å°±è©²æƒ³åˆ°å“ªç¨®ç‰¹æ€§
  // prepaid: å„²å€¼å¡åœ¨é€™é¡Œçš„é©é…èªªæ³•
  // credit: ä¿¡ç”¨å¡åœ¨é€™é¡Œçš„é©é…èªªæ³•
  const QUESTIONS = [
    {
      text: "ä½ æ˜¯åœ‹ä¸­ç”Ÿï¼Œç”¨éŠæˆ²é»æ•¸è²·é€ å‹ã€‚å®¶é•·å¸Œæœ›ä½ ã€Œä¸æœƒè¶…æ”¯ã€ä¹Ÿä¸æœƒæ¬ éŒ¢ã€ã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "prepaid",
      focus: "é ç®—æ§ç®¡ / ä¸è² å‚µ",
      trap: "åªè¨˜å¾—ã€ä¿¡ç”¨å¡æ¯”è¼ƒæ–¹ä¾¿ã€å°±äº‚é¸",
      key: "ä¸æƒ³æ¬ éŒ¢ã€èŠ±å¤šå°‘ç®—å¤šå°‘ â†’ å…ˆæœ‰éŒ¢å†èŠ±",
      prepaid: "å…ˆå„²å€¼å†æ¶ˆè²»ï¼Œæœ€å¤šåªèŠ±åˆ°å¡å…§é¤˜é¡ï¼Œè¼ƒä¸æœƒè¶…æ”¯ã€‚",
      credit: "å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾ï¼Œè‹¥è‡ªåˆ¶åŠ›ä¸è¶³å®¹æ˜“è¶…æ”¯ï¼Œç”šè‡³ç”¢ç”Ÿå¾ªç’°åˆ©æ¯ã€‚"
    },
    {
      text: "ä½ åœ¨ç¶²è·¯è³¼ç‰©è²·åˆ°ç‘•ç–µå“ï¼Œè³£å®¶å¤±è¯ã€‚ä½ å¸Œæœ›æœ‰æ©Ÿæœƒå‘éŠ€è¡Œç”³è¨´ã€è®“æ¬¾é …å…ˆä¸è¦è¢«æ‰£èµ°ã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "credit",
      focus: "æ¶ˆè²»çˆ­è­° / äº¤æ˜“ä¿éšœ",
      trap: "åªæƒ³åˆ°ã€å…ˆä»˜/å¾Œä»˜ã€å¿½ç•¥ä¿éšœæ©Ÿåˆ¶",
      key: "äº¤æ˜“æœ‰çˆ­è­°ã€éœ€è¦ç”³è¨´ç®¡é“ â†’ éŠ€è¡Œä»‹å…¥",
      prepaid: "é€šå¸¸æ˜¯å…ˆä»˜æ¬¾å®Œæˆäº¤æ˜“ï¼Œé‡åˆ°ç³¾ç´›æ™‚ï¼Œè¿½å›æ¬¾é …ç›¸å°ä¸æ˜“ã€‚",
      credit: "å¸¸è¦‹æœ‰çˆ­è­°æ¬¾/æ‹’ä»˜ç­‰è™•ç†æ©Ÿåˆ¶ï¼Œå°æ¶ˆè²»è€…ä¿éšœè¼ƒé«˜ã€‚"
    },
    {
      text: "ä½ æœˆåº•ç¾é‡‘ä¸å¤ ï¼Œä½†å¿…é ˆå…ˆè²·æ•™æã€‚ä½ å¸Œæœ›ä¸‹å€‹æœˆé ˜åˆ°é›¶ç”¨éŒ¢å†ä»˜ä¹Ÿå¯ä»¥ã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "credit",
      focus: "ç¾é‡‘æµ / å»¶å¾Œä»˜æ¬¾",
      trap: "æŠŠã€èƒ½å…ˆè²·ã€èª¤ä»¥ç‚ºã€ä¸ç”¨ä»˜ã€",
      key: "å…ˆæ‹¿åˆ°å•†å“ã€ä¹‹å¾Œå†ä»˜æ¬¾ â†’ å»¶å¾Œä»˜æ¬¾åŠŸèƒ½",
      prepaid: "å¿…é ˆå¡å…§å…ˆæœ‰éŒ¢æ‰èƒ½è²·ï¼Œç¾é‡‘ä¸å¤ å°±ç„¡æ³•ä½¿ç”¨ã€‚",
      credit: "å¯å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾ï¼Œèƒ½çŸ­æœŸèª¿åº¦ç¾é‡‘æµï¼Œä½†è¦è¨˜å¾—åˆ°æœŸç¹³æ¬¾ã€‚"
    },
    {
      text: "ä½ æ“”å¿ƒå¡ç‰‡è¢«ç›œç”¨ï¼Œæƒ³è¦ã€Œæœ€å£æƒ…æ³æå¤±æœ‰ä¸Šé™ã€ã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "prepaid",
      focus: "é¢¨éšªæ§ç®¡ / æå¤±ä¸Šé™",
      trap: "ä»¥ç‚ºã€ä¿¡ç”¨å¡ä¸€å®šæ¯”è¼ƒå®‰å…¨ã€",
      key: "æƒ³æŠŠæå¤±é–åœ¨å›ºå®šä¸Šé™ â†’ åªèŠ±å¡å…§é¤˜é¡",
      prepaid: "æœ€å¤šæå¤±å¡å…§å‰©é¤˜é‡‘é¡ï¼Œé¢¨éšªä¸Šé™è¼ƒæ˜ç¢ºã€‚",
      credit: "è‹¥è¢«ç›œåˆ·å¯èƒ½é‡‘é¡è¼ƒå¤§ï¼ˆé›–å¯ç”³è¨´ï¼‰ï¼Œä½†çŸ­æœŸé¢¨éšªæ„Ÿè¼ƒé«˜ã€‚"
    },
    {
      text: "åŒå­¸æƒ³è²·æ˜‚è²´å‘¨é‚Šï¼Œä½†å®¶é•·è¦æ±‚ã€Œæ¯æœˆåªèƒ½èŠ±å›ºå®šé‡‘é¡ã€ã€‚ä½ è¦å¹«ä»–é¸ä¸€ç¨®å·¥å…·ï¼Œè®“ä»–ä¸å®¹æ˜“è¶…éé ç®—ã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "prepaid",
      focus: "è‡ªæˆ‘æ§åˆ¶ / å…ˆå­˜å¾ŒèŠ±",
      trap: "æŠŠã€é¡åº¦ã€èª¤ç•¶æˆã€é ç®—ã€",
      key: "å›ºå®šé‡‘é¡ã€é¿å…è¡å‹• â†’ å…ˆå„²å€¼å†èŠ±",
      prepaid: "å¯å…ˆè¨­å®šæ¯æœˆå„²å€¼ä¸Šé™ï¼ŒèŠ±å®Œå°±åœï¼Œæœ€ç¬¦åˆé ç®—ç®¡ç†ã€‚",
      credit: "é¡åº¦å­˜åœ¨å®¹æ˜“è®“äººèª¤ä»¥ç‚ºã€é‚„èƒ½åˆ·ã€ï¼Œé€ æˆè¡å‹•æ¶ˆè²»ã€‚"
    },
    {
      text: "ä½ è¦è¨‚é£¯åº—ï¼Œä½†é£¯åº—æœƒå…ˆåšã€Œé æˆæ¬Šã€æš«æ‰£ä¸€ç­†æŠ¼é‡‘ã€‚ä½ å¸Œæœ›æŠ¼é‡‘è™•ç†æ¯”è¼ƒå½ˆæ€§ã€å‡ºå•é¡Œèƒ½æ¯”è¼ƒå¥½æºé€šã€‚ä½ æœƒé¸å“ªä¸€ç¨®ï¼Ÿ",
      answer: "credit",
      focus: "é æˆæ¬Š / äº¤æ˜“æµç¨‹å½ˆæ€§",
      trap: "åªç”¨ã€å…ˆä»˜å¾Œä»˜ã€åˆ¤æ–·ï¼Œå¿½ç•¥é æˆæ¬Šå½±éŸ¿",
      key: "é æˆæ¬Šæš«æ‰£ã€éœ€è¦å½ˆæ€§ â†’ ä¿¡ç”¨å¡å¸¸è¦‹",
      prepaid: "è‹¥é¤˜é¡ä¸è¶³æˆ–æš«æ‰£å½±éŸ¿å¾ŒçºŒæ¶ˆè²»ï¼Œå¯èƒ½ä¸æ–¹ä¾¿ã€‚",
      credit: "é æˆæ¬Šè™•ç†è¼ƒå¸¸è¦‹ï¼Œäº¤æ˜“å½ˆæ€§èˆ‡å¾ŒçºŒç”³è¨´ç®¡é“ç›¸å°å®Œæ•´ã€‚"
    }
  ];

  // ====== UI refs ======
  const $ = (id) => document.getElementById(id);
  const game = $("game");
  const overlay = $("overlay");
  const ovCount = $("ovCount");
  const ovBar = $("ovBar");
  const qtext = $("qtext");
  const tagFocus = $("tagFocus");
  const tagTrap = $("tagTrap");
  const tagKey = $("tagKey");

  const statScore = $("statScore");
  const statStreak = $("statStreak");
  const statQ = $("statQ");
  const msg = $("msg");

  const cmp = $("compare");
  const cmpResult = $("cmpResult");
  const cmpHeadline = $("cmpHeadline");
  const cmpChip = $("cmpChip");
  const cmpOneLine = $("cmpOneLine");
  const cmpPrepaid = $("cmpPrepaid");
  const cmpCredit = $("cmpCredit");

  const btnStart = $("btnStart");
  const btnReset = $("btnReset");
  const speedEl = $("speed");
  const difficultyEl = $("difficulty");

  // ====== game state ======
  let qIndex = -1;
  let score = 0;
  let streak = 0;
  let locked = false;
  let canShoot = false;

  let birds = [];
  let raf = 0;

  function setHUD() {
    statScore.textContent = `åˆ†æ•¸ï¼š${score}`;
    statStreak.textContent = `é€£å°ï¼š${streak}`;
    statQ.textContent = `é¡Œè™Ÿï¼š${Math.max(0, qIndex+1)}/${QUESTIONS.length}`;
  }

  function setMsg(html) {
    msg.innerHTML = html;
  }

  function clearBirds() {
    birds.forEach(b => b.el.remove());
    birds = [];
  }

  function hideCompare() {
    cmp.style.display = "none";
  }

  function showCompare(isCorrect, q, picked) {
    // ä¸€å¥æ¯”è¼ƒè¡¨ï¼ˆBï¼‰
    const right = q.answer === "prepaid" ? "å„²å€¼å¡" : "ä¿¡ç”¨å¡";
    const pickedTxt = picked === "prepaid" ? "å„²å€¼å¡" : "ä¿¡ç”¨å¡";

    cmpResult.textContent = isCorrect ? "âœ…" : "âŒ";
    cmpChip.textContent = `ä½ é¸ï¼š${pickedTxt}ï½œæ­£è§£ï¼š${right}`;

    // headline
    cmpHeadline.textContent = "æœ¬é¡Œé‡é»æ¯”è¼ƒï¼ˆæŠŠç‰¹æ€§é‡æ¸…ï¼‰";

    // one-line compare: ä¸€å¥è©±å¸¶èµ°
    // ç”¨ã€Œç„¦é» + çµè«–ã€å¯«æˆèª²å ‚å¯ä»¥æœ—è®€çš„å¥å­
    const line = isCorrect
      ? `ä½ æ˜¯ç”¨ã€Œ${q.focus}ã€åœ¨åˆ¤æ–·ï¼šæ­¤æƒ…å¢ƒæ›´é©åˆ <b>${right}</b>ã€‚`
      : `é€™é¡Œä¸æ˜¯çœ‹æ‰‹å¿«ï¼Œæ˜¯çœ‹ã€Œ${q.focus}ã€ã€‚æ­¤æƒ…å¢ƒæ›´é©åˆ <b>${right}</b>ï¼Œå› ç‚ºï¼š${q.key}ã€‚`;

    cmpOneLine.innerHTML = line;

    // table rows: å°ç…§è¡¨ï¼ˆå…©è¡Œï¼‰
    cmpPrepaid.textContent = q.prepaid;
    cmpCredit.textContent = q.credit;

    cmp.style.display = "block";
  }

  // ====== Bird SVG (no external assets) ======
  function birdSVG(kind) {
    // kind: "prepaid" or "credit" or "decoy"
    // use different accent colors by kind
    const fill = kind === "prepaid" ? "#9cffd9" : (kind === "credit" ? "#6aa9ff" : "#ffd66a");
    const stroke = "rgba(255,255,255,.18)";
    return `
      <svg width="28" height="28" viewBox="0 0 64 64" aria-hidden="true">
        <path d="M46 18c-7-9-21-9-28 0-7 8-6 20 3 28 9 9 23 10 30 1 6-8 4-18-5-23z"
              fill="${fill}" opacity="0.95" stroke="${stroke}" stroke-width="2" />
        <path d="M45 25c5 0 9-4 9-9-5 0-9 4-9 9z" fill="${fill}" opacity="0.75"/>
        <circle cx="39" cy="28" r="2.6" fill="#0b1020"/>
        <path d="M21 36c7 4 14 4 22 0" fill="none" stroke="rgba(11,16,32,.35)" stroke-width="3" stroke-linecap="round"/>
        <path d="M48 33l9 3-9 3z" fill="#ffb36a" opacity="0.9"/>
      </svg>
    `;
  }

  // ====== spawn logic ======
  function diffConfig() {
    const d = difficultyEl.value;
    if (d === "easy") return { total: 2, decoys: 1 };
    if (d === "hard") return { total: 4, decoys: 2 };
    return { total: 3, decoys: 1 }; // normal
  }

  function spawnBirdsForQuestion(q) {
    clearBirds();
    hideCompare();

    const cfg = diffConfig();
    // total birds = cfg.total
    // must include at least one correct and one incorrect of the two options.
    const correct = q.answer; // "prepaid" or "credit"
    const wrong = correct === "prepaid" ? "credit" : "prepaid";

    // Build bird choices: 1 correct + 1 wrong + decoys (could be duplicates but labeled different)
    const slots = [];
    slots.push({ choice: correct, label: correct === "prepaid" ? "å„²å€¼å¡" : "ä¿¡ç”¨å¡", sub: "ï¼ˆè¼ƒé©åˆæœ¬æƒ…å¢ƒï¼‰", type: "good" });
    slots.push({ choice: wrong, label: wrong === "prepaid" ? "å„²å€¼å¡" : "ä¿¡ç”¨å¡", sub: "ï¼ˆçœ‹èµ·ä¾†ä¹Ÿåƒâ€¦ä½†è¦å°å¿ƒï¼‰", type: "bad" });

    // decoys: still either prepaid/credit but with misleading subtitle to force thinking
    const decoyPhrases = [
      "ï¼ˆå› ç‚ºã€æ–¹ä¾¿ã€å°±é¸ï¼Ÿï¼‰",
      "ï¼ˆåªçœ‹ã€å…ˆä»˜/å¾Œä»˜ã€æœƒä¸­æ‹›ï¼‰",
      "ï¼ˆæƒ³æƒ³ï¼šé¢¨éšª/ä¿éšœ/é ç®—ï¼‰",
      "ï¼ˆé—œéµç·šç´¢åœ¨å“ªï¼Ÿï¼‰",
      "ï¼ˆå…ˆåˆ¥æ€¥ï¼Œå›åˆ°æƒ…å¢ƒï¼‰"
    ];
    for (let i=0; i<cfg.total-2; i++) {
      const pick = (i % 2 === 0) ? wrong : correct; // alternate to increase confusion
      slots.push({
        choice: pick,
        label: pick === "prepaid" ? "å„²å€¼å¡" : "ä¿¡ç”¨å¡",
        sub: decoyPhrases[(Math.random()*decoyPhrases.length)|0],
        type: "neutral"
      });
    }

    // Create DOM birds
    slots.forEach((s, idx) => {
      const el = document.createElement("div");
      el.className = `bird ${s.type}`;
      el.dataset.choice = s.choice;

      el.innerHTML = `
        <div class="icon">${birdSVG(s.choice === "prepaid" ? "prepaid" : "credit")}</div>
        <div class="txt">
          <div class="top">${s.label}</div>
          <div class="sub">${s.sub}</div>
        </div>
      `;

      // click handler
      el.addEventListener("click", (ev) => {
        ev.stopPropagation();
        onBirdHit(el);
      });

      game.appendChild(el);

      // movement params
      const bw = 180;
      const bh = 56;
      const pad = 12;

      const x0 = pad + Math.random() * (game.clientWidth - bw - pad*2);
      const y0 = 90 + Math.random() * (game.clientHeight - bh - 110);
      const dirx = Math.random() > 0.5 ? 1 : -1;
      const diry = Math.random() > 0.5 ? 1 : -1;

      // base speed (slower than before) * slider * slight random
      const base = 0.55 + Math.random()*0.35; // slow-friendly
      const vx = dirx * base * (0.9 + Math.random()*0.35);
      const vy = diry * base * (0.7 + Math.random()*0.35);

      birds.push({
        el,
        x: x0, y: y0,
        vx, vy,
        w: bw, h: bh
      });
    });

    // Start RAF movement
    cancelAnimationFrame(raf);
    raf = requestAnimationFrame(tick);
  }

  function tick() {
    const sp = parseFloat(speedEl.value || "1.0");
    const W = game.clientWidth;
    const H = game.clientHeight;

    const minY = 84;
    const maxY = H - 70;

    birds.forEach(b => {
      // keep moving forever
      b.x += b.vx * sp;
      b.y += b.vy * sp;

      // bounce
      if (b.x < 10) { b.x = 10; b.vx *= -1; }
      if (b.x > W - b.w - 10) { b.x = W - b.w - 10; b.vx *= -1; }

      if (b.y < minY) { b.y = minY; b.vy *= -1; }
      if (b.y > maxY - b.h) { b.y = maxY - b.h; b.vy *= -1; }

      b.el.style.transform = `translate(${b.x}px, ${b.y}px)`;
    });

    raf = requestAnimationFrame(tick);
  }

  // ====== answer handling ======
  function onBirdHit(el) {
    if (!canShoot) return;
    if (locked) return;
    locked = true;

    const q = QUESTIONS[qIndex];
    const picked = el.dataset.choice;
    const correct = (picked === q.answer);

    if (correct) {
      score += 10;
      streak += 1;
      setMsg(`<span class="good">âœ… æ‰“ä¸­ï¼</span> ä½ æ˜¯ç”¨ã€Œ<b>${q.focus}</b>ã€åœ¨åˆ¤æ–·ï¼Œåšå¾—å¥½ã€‚`);
    } else {
      score = Math.max(0, score - 5);
      streak = 0;
      setMsg(`<span class="bad">âŒ æ‰“éŒ¯ï¼</span> é€™é¡Œçš„é—œéµæ˜¯ã€Œ<b>${q.focus}</b>ã€ï¼Œç·šç´¢ï¼š<b>${q.key}</b>ã€‚`);
    }

    setHUD();
    clearBirds();
    showCompare(correct, q, picked);

    // unlock after short moment, but keep compare shown until next
    setTimeout(() => { locked = false; }, 300);
  }

  // ====== countdown (5 sec) ======
  function showOverlay(q) {
    overlay.style.display = "flex";
    const total = 5;
    let t = total;

    ovCount.textContent = `${t} ç§’å¾Œé–‹å§‹`;
    ovBar.style.width = "0%";

    const start = performance.now();
    const duration = total * 1000;

    function step(now) {
      const p = Math.min(1, (now - start) / duration);
      ovBar.style.width = `${Math.floor(p * 100)}%`;

      const left = Math.max(0, Math.ceil(total - p*total));
      if (left !== t) {
        t = left;
        ovCount.textContent = `${t} ç§’å¾Œé–‹å§‹`;
      }
      if (p < 1) {
        requestAnimationFrame(step);
      } else {
        overlay.style.display = "none";
      }
    }
    requestAnimationFrame(step);
  }

  // ====== round flow ======
  function showQuestion(q) {
    qtext.textContent = q.text;
    tagFocus.textContent = `ç„¦é»ï¼š${q.focus}`;
    tagTrap.textContent = `å¸¸è¦‹èª¤å€ï¼š${q.trap}`;
    tagKey.textContent = `é—œéµç·šç´¢ï¼š${q.key}`;
  }

  function nextQuestion() {
    // If already ended, loop to start
    qIndex += 1;
    if (qIndex >= QUESTIONS.length) {
      qIndex = 0;
      score = 0;
      streak = 0;
      setMsg(`<span class="warn">å·²å›åˆ°ç¬¬ä¸€é¡Œã€‚</span> æƒ³æŒ‘æˆ°çœ‹çœ‹èƒ½ä¸èƒ½å…¨å°ï¼Ÿ`);
    }
    setHUD();

    canShoot = false;
    hideCompare();
    clearBirds();

    const q = QUESTIONS[qIndex];
    showQuestion(q);

    // å…ˆäº®é¡Œ 5 ç§’
    showOverlay(q);
    setMsg(`<span class="warn">ğŸ“Œ å…ˆè®€é¡Œï¼š</span> çœ‹ã€Œèª°æ‰¿æ“”é¢¨éšªã€èƒ½ä¸èƒ½è¶…æ”¯ã€æœ‰æ²’æœ‰ä¿éšœã€â€”â€”5 ç§’å¾Œé–‹å§‹ã€‚`);

    setTimeout(() => {
      canShoot = true;
      spawnBirdsForQuestion(q);
      setMsg(`<span class="good">é–‹å§‹ï¼</span> ä¾ç…§æƒ…å¢ƒåˆ¤æ–·ï¼Œæ‰“ä¸­ä½ èªç‚ºæ­£ç¢ºçš„é‚£éš»é³¥ã€‚`);
    }, 5000);
  }

  function resetAll() {
    qIndex = -1;
    score = 0;
    streak = 0;
    locked = false;
    canShoot = false;
    clearBirds();
    hideCompare();
    qtext.textContent = "æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚";
    tagFocus.textContent = "ç„¦é»ï¼šâ€”";
    tagTrap.textContent = "å¸¸è¦‹èª¤å€ï¼šâ€”";
    tagKey.textContent = "é—œéµç·šç´¢ï¼šâ€”";
    setHUD();
    setMsg(`<span class="warn">æç¤ºï¼š</span>é€™ä¸æ˜¯æ¯”æ‰‹å¿«ï¼Œæ˜¯æ¯”ä½ èƒ½ä¸èƒ½æŠŠã€Œæƒ…å¢ƒã€å°ä¸Šã€Œå·¥å…·ç‰¹æ€§ã€ã€‚`);
  }

  // ====== Events ======
  btnStart.addEventListener("click", () => {
    nextQuestion();
  });

  btnReset.addEventListener("click", () => {
    resetAll();
  });

  // keep birds bouncing on resize
  window.addEventListener("resize", () => {
    // birds will bounce naturally; no need to reset positions
  });

  // init
  setHUD();
  statQ.textContent = `é¡Œè™Ÿï¼š0/${QUESTIONS.length}`;
})();
</script>
</body>
</html>
