<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2D æ‰“é³¥å­¸æµç¨‹ï¼šå„²å€¼å¡ vs ä¿¡ç”¨å¡</title>
  <style>
    :root{
      --bg:#06101f;
      --panel: rgba(0,0,0,.55);
      --panel2: rgba(255,255,255,.06);
      --txt:#eaf2ff;
      --muted:#b7c3da;
      --good:#43f08a;
      --bad:#ff5b6a;
      --warn:#ffd36a;
      --line: rgba(255,255,255,.14);
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,"Noto Sans TC",Segoe UI,Roboto,Arial;}
    #wrap{height:100%;display:grid;grid-template-rows:auto 1fr auto;}

    header{
      padding:12px 14px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
      display:flex; gap:10px; align-items:center; flex-wrap:wrap;
    }
    header .pill{
      padding:4px 10px;border-radius:999px;
      border:1px solid var(--line);
      background:var(--panel2);
      font-size:12px;color:var(--muted);
      white-space:nowrap;
    }
    header b{font-weight:800;color:var(--txt)}
    #title{font-size:14px;color:var(--muted)}
    #title b{color:var(--txt)}
    #controls{margin-left:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    button{
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
      color:var(--txt);
      padding:8px 10px;border-radius:10px;
      font-weight:700;
      cursor:pointer;
    }
    button:active{transform:translateY(1px)}
    .small{font-size:12px;color:var(--muted)}
    select, input[type="range"]{
      background:rgba(255,255,255,.08);
      color:var(--txt);
      border:1px solid var(--line);
      border-radius:10px;
      padding:7px 10px;
      outline:none;
    }
    input[type="range"]{padding:0;height:32px}

    #game{
      position:relative; overflow:hidden;
      touch-action: manipulation;
      cursor: crosshair;
      background:
        radial-gradient(900px 500px at 20% 20%, rgba(0,255,200,.10), transparent 60%),
        radial-gradient(900px 500px at 80% 30%, rgba(90,120,255,.10), transparent 60%),
        radial-gradient(700px 400px at 50% 110%, rgba(255,210,90,.10), transparent 55%),
        #06101f;
    }

    /* HUD / Question */
    #hud{
      position:absolute; left:12px; right:12px; top:12px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      display:grid;
      gap:6px;
      backdrop-filter: blur(6px);
    }
    #qText{
      font-size:16px;
      line-height:1.35;
      font-weight:800;
      letter-spacing:.2px;
    }
    #qMeta{
      display:flex; gap:10px; flex-wrap:wrap;
      font-size:12px; color:var(--muted);
    }
    #hintLine{
      font-size:13px; color:var(--muted);
      line-height:1.35;
    }

    /* Feedback bar */
    footer{
      padding:10px 14px;
      border-top:1px solid var(--line);
      background: linear-gradient(0deg, rgba(255,255,255,.06), rgba(255,255,255,0));
    }
    #feedback{
      min-height:44px;
      background:var(--panel);
      border:1px solid var(--line);
      border-radius:14px;
      padding:10px 12px;
      color:var(--txt);
      line-height:1.35;
      display:flex;
      align-items:flex-start;
      gap:10px;
    }
    #feedback .tag{
      padding:2px 8px;border-radius:999px;font-size:12px;font-weight:900;flex:0 0 auto;
      border:1px solid var(--line);
      background:rgba(255,255,255,.08);
    }
    #feedback.good .tag{border-color:rgba(67,240,138,.45); color:var(--good)}
    #feedback.bad .tag{border-color:rgba(255,91,106,.45); color:var(--bad)}
    #feedback.warn .tag{border-color:rgba(255,211,106,.45); color:var(--warn)}
    #feedbackText{font-size:13px;color:var(--txt)}

    /* Birds */
    .bird{
      position:absolute;
      display:flex;
      align-items:center;
      gap:10px;
      padding:10px 12px;
      border-radius:16px;
      border:1px solid rgba(255,255,255,.20);
      background: rgba(0,0,0,.35);
      box-shadow: 0 10px 30px rgba(0,0,0,.25);
      user-select:none;
      transform: translateZ(0);
    }
    .bird:hover{border-color:rgba(255,255,255,.35)}
    .bird:active{transform: translateZ(0) scale(.99)}
    .bird .emoji{
      font-size:42px;
      line-height:1;
      filter: drop-shadow(0 6px 10px rgba(0,0,0,.25));
    }
    .bird .bubble{
      display:flex;
      flex-direction:column;
      gap:2px;
      min-width: 140px;
    }
    .bird .choice{
      font-size:14px;
      font-weight:900;
      line-height:1.15;
    }
    .bird .sub{
      font-size:12px;
      color:var(--muted);
      line-height:1.2;
    }

    /* Mobile: bigger tap targets */
    @media (max-width: 560px){
      #qText{font-size:15px}
      .bird{padding:10px 10px;border-radius:16px}
      .bird .emoji{font-size:44px}
      .bird .bubble{min-width: 120px}
    }
  </style>
</head>
<body>
  <div id="wrap">
    <header>
      <div id="title"><b>2D æ‰“é³¥å­¸æµç¨‹</b>ï¼šå„²å€¼å¡ vs ä¿¡ç”¨å¡</div>
      <div class="pill">åˆ†æ•¸ï¼š<b id="score">0</b></div>
      <div class="pill">é€£å°ï¼š<b id="streak">0</b></div>
      <div class="pill">é¡Œè™Ÿï¼š<b id="qNo">1</b>/<b id="qTotal">1</b></div>

      <div id="controls">
        <label class="small">é€Ÿåº¦</label>
        <input id="speed" type="range" min="0.6" max="1.6" step="0.05" value="1.0" />
        <label class="small">é›£åº¦</label>
        <select id="level">
          <option value="easy">ç°¡å–®</option>
          <option value="normal" selected>ä¸€èˆ¬</option>
          <option value="hard">å›°é›£</option>
        </select>
        <button id="btnNext">é–‹å§‹ / ä¸‹ä¸€é¡Œ</button>
        <button id="btnReset">é‡ä¾†</button>
      </div>
    </header>

    <main id="game" aria-label="game area">
      <div id="hud">
        <div id="qText">æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚</div>
        <div id="qMeta">
          <span>è¦å‰‡ï¼šæ‰“ä¸­ã€Œæ­£ç¢ºæµç¨‹ã€é‚£éš»é³¥</span>
          <span>æç¤ºï¼šçœ‹æ¸…æ¥šæƒ…å¢ƒä¸­çš„ã€Œæ‰£æ¬¾æ™‚é–“ / å…ˆä»˜å¾Œä»˜ã€</span>
        </div>
        <div id="hintLine">ï¼ˆæ‰“éŒ¯ä¹Ÿæ²’é—œä¿‚ï¼Œæˆ‘æœƒå‘Šè¨´ä½ ç‚ºä»€éº¼ï¼‰</div>
      </div>
    </main>

    <footer>
      <div id="feedback" class="warn">
        <div class="tag">æç¤º</div>
        <div id="feedbackText">æº–å‚™å¥½äº†å°±æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€ã€‚å¦‚æœä½ è¦ºå¾—å¤ªå¿«ï¼ŒæŠŠã€Œé€Ÿåº¦ã€æ‹‰ä½ã€‚</div>
      </div>
    </footer>
  </div>

<script>
(() => {
  // ---------------------------
  // é¡Œåº«ï¼šæ›´ã€Œæ“¬çœŸã€çš„æƒ…å¢ƒåˆ¤æ–·
  // ---------------------------
  const QUESTIONS = [
    {
      text: "å°æ˜å…ˆåœ¨å¡ç‰‡è£¡ã€Œå„²å€¼ 300 å…ƒã€ï¼Œå†å»è²·é£²æ–™ã€‚é€™æ¬¡æ¶ˆè²»çš„éŒ¢æ˜¯ä»€éº¼æ™‚å€™æ‰£çš„ï¼Ÿ",
      answerFlow: "prepaid",
      explain: "å„²å€¼å¡ = å…ˆæŠŠéŒ¢å­˜é€²å»ï¼›æ¶ˆè²»æ™‚å°±æ˜¯ç”¨ã€Œå·²ç¶“å­˜åœ¨è£¡é¢çš„éŒ¢ã€ã€‚",
      hint: "é—œéµå­—ï¼šã€å…ˆå„²å€¼ã€â†’ å…ˆä»˜éŒ¢"
    },
    {
      text: "å°ç¾åˆ·å¡è²·è¡£æœï¼Œåº—å®¶å…ˆæ”¶åˆ°éŒ¢ï¼Œä½†å°ç¾æ˜¯ã€Œæœˆåº•æ‰ä¸€èµ·ç¹³ã€ã€‚é€™æ¯”è¼ƒåƒå“ªä¸€ç¨®æµç¨‹ï¼Ÿ",
      answerFlow: "credit",
      explain: "ä¿¡ç”¨å¡ = éŠ€è¡Œå…ˆå¹«ä½ ä»˜ï¼›ä½ ä¹‹å¾Œï¼ˆä¾‹å¦‚æœˆåº•ï¼‰å†é‚„éŠ€è¡Œã€‚",
      hint: "é—œéµå­—ï¼šã€æœˆåº•æ‰ç¹³ã€â†’ å…ˆç”¨å¾Œä»˜"
    },
    {
      text: "å¦‚æœä½ ä¸€ç›´åˆ·å¡ä½†éƒ½ä¸ç¹³å¸³å–®ï¼Œæœ€å¯èƒ½ç™¼ç”Ÿä»€éº¼äº‹ï¼Ÿï¼ˆåˆ¤æ–·æµç¨‹æ¦‚å¿µï¼‰",
      answerFlow: "credit",
      explain: "é€™é¡Œåœ¨è€ƒï¼šä¿¡ç”¨å¡æ˜¯ã€Œæ¬ æ¬¾ã€æ¦‚å¿µï¼Œä¸ç¹³æœƒæœ‰åˆ©æ¯/é•ç´„/ä¿¡ç”¨å—æç­‰å¾Œæœã€‚",
      hint: "é—œéµå­—ï¼šã€å¸³å–® / æ¬ æ¬¾ã€â†’ ä¿¡ç”¨å¡"
    },
    {
      text: "ä½ è²·éŠæˆ²é»æ•¸ï¼Œå¿…é ˆå…ˆæŠŠé‡‘é¡åŠ åˆ°å¸³è™Ÿè£¡ï¼Œæ‰èƒ½æ‰£é»æ•¸è²·é“å…·ã€‚é€™æ˜¯å“ªä¸€ç¨®ï¼Ÿ",
      answerFlow: "prepaid",
      explain: "åƒé»æ•¸/äº¤é€šå¡/å„²å€¼éŒ¢åŒ…ï¼šå…ˆå­˜å€¼ï¼Œå¾Œä½¿ç”¨ã€‚",
      hint: "é—œéµå­—ï¼šã€å…ˆåŠ å€¼ã€â†’ å„²å€¼"
    },
    {
      text: "åˆ·å¡å¾Œçœ‹åˆ°ã€Œæœ¬æœŸæ‡‰ç¹³é‡‘é¡ã€ï¼Œä½ å¯ä»¥é¸æ“‡å…¨ç¹³æˆ–æœ€ä½æ‡‰ç¹³ã€‚é€™æ¯”è¼ƒåƒå“ªä¸€ç¨®ï¼Ÿ",
      answerFlow: "credit",
      explain: "ã€æ‡‰ç¹³ã€ä»£è¡¨ä½ å…ˆç”¨äº†éŠ€è¡Œçš„éŒ¢ï¼›ä¿¡ç”¨å¡æ‰æœƒæœ‰å¸³å–®èˆ‡æ‡‰ç¹³é‡‘é¡ã€‚",
      hint: "é—œéµå­—ï¼šã€æ‡‰ç¹³ã€â†’ ä¿¡ç”¨å¡"
    }
  ];

  // ---------------------------
  // éŠæˆ²åƒæ•¸
  // ---------------------------
  const game = document.getElementById("game");
  const qText = document.getElementById("qText");
  const hintLine = document.getElementById("hintLine");
  const feedback = document.getElementById("feedback");
  const feedbackText = document.getElementById("feedbackText");
  const scoreEl = document.getElementById("score");
  const streakEl = document.getElementById("streak");
  const qNoEl = document.getElementById("qNo");
  const qTotalEl = document.getElementById("qTotal");
  const btnNext = document.getElementById("btnNext");
  const btnReset = document.getElementById("btnReset");
  const speedEl = document.getElementById("speed");
  const levelEl = document.getElementById("level");

  qTotalEl.textContent = String(QUESTIONS.length);

  let qIndex = 0;
  let score = 0;
  let streak = 0;
  let locked = false;
  let activeBirds = [];
  let rafId = null;

  const FLOW_LABEL = {
    prepaid: "å„²å€¼æµç¨‹ï¼ˆå…ˆä»˜ï¼‰",
    credit: "ä¿¡ç”¨æµç¨‹ï¼ˆå¾Œä»˜ï¼‰"
  };

  // é³¥å¤–è§€ï¼ˆå¯ä¾ç­”æ¡ˆ/å¹²æ“¾åšä¸åŒé³¥ï¼‰
  const BIRDS = [
    { emoji: "ğŸ¦œ", name: "ç¶ é¸šéµ¡" },
    { emoji: "ğŸ¦¢", name: "ç™½å¤©éµ" },
    { emoji: "ğŸ¦‰", name: "è²“é ­é·¹" },
    { emoji: "ğŸ•Šï¸", name: "ç™½é´¿" },
    { emoji: "ğŸ¦", name: "å°è—é³¥" }
  ];

  // é›£åº¦æ±ºå®šï¼šé³¥æ•¸ã€é€Ÿåº¦ã€åœç•™æ™‚é–“
  function getDifficulty() {
    const lv = levelEl.value;
    if (lv === "easy") return { birds: 2, baseSpeed: 90, pauseMs: 1400 };
    if (lv === "hard") return { birds: 4, baseSpeed: 130, pauseMs: 900 };
    return { birds: 3, baseSpeed: 110, pauseMs: 1100 }; // normal
  }

  function setFeedback(kind, tag, text) {
    feedback.className = kind;
    feedback.querySelector(".tag").textContent = tag;
    feedbackText.textContent = text;
  }

  function randInt(a,b){ return Math.floor(Math.random()*(b-a+1))+a; }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }
  function shuffle(arr){
    for(let i=arr.length-1;i>0;i--){
      const j=Math.floor(Math.random()*(i+1));
      [arr[i],arr[j]]=[arr[j],arr[i]];
    }
    return arr;
  }

  // ç”Ÿæˆã€Œæ›´ä¸å–®èª¿ã€çš„é³¥ä¸Šæ–‡å­—ï¼šä¸»é¸é … + å‰¯æè¿°
  function makeChoiceCard(flow, q) {
    if (q.text.includes("ä¸ç¹³")) {
      // é¢¨éšªé¡Œï¼šç”¨çµæœèªå¥åšé¸é …
      return flow === "credit"
        ? { main: "å› ç‚ºæœƒç”¢ç”Ÿæ¬ æ¬¾/å¸³å–®", sub: "å…ˆç”¨å¾Œä»˜ â†’ ä¿¡ç”¨å¡é‚è¼¯" }
        : { main: "å› ç‚ºå…ˆå­˜å€¼ä¸æ¬ æ¬¾", sub: "å…ˆä»˜éŒ¢ â†’ å„²å€¼å¡é‚è¼¯" };
    }

    const templates = {
      prepaid: [
        { main: "å…ˆåŠ å€¼ï¼Œå¾Œæ‰£æ¬¾", sub: "åƒé»æ•¸/äº¤é€šå¡" },
        { main: "éŒ¢å…ˆé€²å¸³æˆ¶", sub: "ç”¨çš„æ˜¯å·²å­˜é‡‘é¡" },
        { main: "æ‰£æ¬¾ç™¼ç”Ÿåœ¨æ¶ˆè²»ç•¶ä¸‹", sub: "å› ç‚ºéŒ¢æ—©å°±å­˜äº†" },
      ],
      credit: [
        { main: "å…ˆæ¶ˆè²»ï¼Œå¾Œçµå¸³", sub: "æœˆåº•çœ‹å¸³å–®" },
        { main: "éŠ€è¡Œå…ˆå¢Šæ¬¾", sub: "ä½ ä¹‹å¾Œå†é‚„" },
        { main: "æœ‰æ‡‰ç¹³é‡‘é¡", sub: "å¯èƒ½åˆ©æ¯/ä¿¡ç”¨ç´€éŒ„" },
      ]
    };

    // è®“æ¯é¡Œçœ‹èµ·ä¾†æ›´è²¼åˆ
    if (q.text.includes("æœˆåº•")) {
      return flow === "credit"
        ? { main: "æœˆåº•ä¸€èµ·ç¹³", sub: "å…ˆç”¨å¾Œä»˜ï¼ˆä¿¡ç”¨ï¼‰" }
        : { main: "å…ˆåŠ å€¼å†è²·", sub: "å…ˆä»˜å¾Œç”¨ï¼ˆå„²å€¼ï¼‰" };
    }
    if (q.text.includes("å„²å€¼") || q.text.includes("åŠ åˆ°å¸³è™Ÿ")) {
      return flow === "prepaid"
        ? { main: "å…ˆå„²å€¼æ‰å¯è²·", sub: "å…ˆä»˜å¾Œç”¨ï¼ˆå„²å€¼ï¼‰" }
        : { main: "å…ˆåˆ·å¾Œç¹³", sub: "å…ˆç”¨å¾Œä»˜ï¼ˆä¿¡ç”¨ï¼‰" };
    }

    return pick(templates[flow]);
  }

  // å»ºé³¥
  function createBird({ flow, y, dir, speedPx, pauseMs, labelMain, labelSub }) {
    const el = document.createElement("div");
    el.className = "bird";
    el.dataset.flow = flow;

    const birdFace = pick(BIRDS);

    el.innerHTML = `
      <div class="emoji" aria-hidden="true">${birdFace.emoji}</div>
      <div class="bubble">
        <div class="choice">${labelMain}</div>
        <div class="sub">${labelSub}</div>
      </div>
    `;

    const rect = game.getBoundingClientRect();
    const startX = dir === "L2R" ? -260 : rect.width + 260;
    el.style.left = startX + "px";
    el.style.top = y + "px";

    // å‹•æ…‹è³‡æ–™
    const obj = {
      el,
      flow,
      x: startX,
      y,
      dir,
      speedPx,     // px/sec
      pauseMs,
      paused: false,
      pauseUntil: 0,
      removed: false
    };

    el.addEventListener("click", () => onHit(obj));

    game.appendChild(el);
    activeBirds.push(obj);
  }

  function clearBirds() {
    activeBirds.forEach(b => {
      try { b.el.remove(); } catch(e){}
    });
    activeBirds = [];
    if (rafId) cancelAnimationFrame(rafId);
    rafId = null;
  }

  // ä¸€å›åˆå‡ºé¡Œ
  function spawnRound() {
    clearBirds();
    locked = false;

    const q = QUESTIONS[qIndex];
    qNoEl.textContent = String(qIndex + 1);
    qText.textContent = q.text;
    hintLine.textContent = "æç¤ºï¼š" + q.hint;

    const { birds, baseSpeed, pauseMs } = getDifficulty();
    const speedMul = parseFloat(speedEl.value || "1.0");

    // æ±ºå®šé€™å›åˆæœ‰å¹¾éš»é³¥è¦ç”Ÿæˆ
    // å¿…å®šå« 1 éš»æ­£è§£ï¼Œå…¶é¤˜ç‚ºå¹²æ“¾
    const flows = [q.answerFlow];
    while (flows.length < birds) {
      flows.push(flows.length % 2 === 1 ? (q.answerFlow === "prepaid" ? "credit" : "prepaid") : (Math.random() < .5 ? "prepaid" : "credit"));
    }
    shuffle(flows);

    // ç”Ÿæˆä½ç½®ï¼šåˆ†æ•£ï¼Œé¿å…ç–Šåœ¨ä¸€èµ·
    const rect = game.getBoundingClientRect();
    const topSafe = 100;
    const bottomSafe = 80;
    const laneCount = birds;
    const laneGap = Math.max(70, (rect.height - topSafe - bottomSafe) / Math.max(1, laneCount));
    const lanes = [];
    for (let i = 0; i < laneCount; i++) lanes.push(topSafe + i * laneGap);
    shuffle(lanes);

    flows.forEach((flow, i) => {
      const dir = Math.random() < 0.5 ? "L2R" : "R2L";

      const card = makeChoiceCard(flow, q);
      const s = (baseSpeed * speedMul) * (0.85 + Math.random() * 0.35); // æœ‰é»å·®ç•°ä½†ä¸æœƒäº‚
      const p = pauseMs + randInt(-150, 200);

      createBird({
        flow,
        y: Math.min(rect.height - bottomSafe, lanes[i] || (topSafe + i * 85)),
        dir,
        speedPx: s,
        pauseMs: p,
        labelMain: card.main,
        labelSub: card.sub
      });
    });

    setFeedback("warn", "æç¤º", "è«‹æ‰“ä¸­ã€Œæ­£ç¢ºæµç¨‹ã€é‚£éš»é³¥ã€‚ï¼ˆçœ‹æ¸…æ¥šï¼šå…ˆä»˜ï¼Ÿå¾Œä»˜ï¼Ÿï¼‰");
    rafId = requestAnimationFrame(loop);
  }

  // éŠæˆ²ä¸»è¿´åœˆï¼šæ…¢é€Ÿã€åœä¸€ä¸‹ï¼Œè®“å­—èƒ½çœ‹æ¸…æ¥š
  let lastT = 0;
  function loop(t) {
    if (!lastT) lastT = t;
    const dt = (t - lastT) / 1000;
    lastT = t;

    const rect = game.getBoundingClientRect();

    for (const b of activeBirds) {
      if (b.removed) continue;

      // åœä¸€ä¸‹ï¼ˆä¸­æ®µ pauseï¼Œè®“å­¸ç”Ÿæœ‰æ™‚é–“çœ‹å­—ï¼‰
      if (!b.paused) {
        const mid = rect.width / 2;
        if ((b.dir === "L2R" && b.x >= mid - 40 && b.x <= mid + 40) ||
            (b.dir === "R2L" && b.x <= mid + 40 && b.x >= mid - 40)) {
          b.paused = true;
          b.pauseUntil = performance.now() + b.pauseMs;
        }
      } else {
        if (performance.now() < b.pauseUntil) {
          // é‚„åœ¨åœ
          b.el.style.left = b.x + "px";
          continue;
        } else {
          b.paused = false;
        }
      }

      const v = b.speedPx; // px/sec
      b.x += (b.dir === "L2R" ? 1 : -1) * v * dt;

      b.el.style.left = b.x + "px";

      // å‡ºç•Œåˆªé™¤
      if (b.dir === "L2R" && b.x > rect.width + 300) b.removed = true;
      if (b.dir === "R2L" && b.x < -320) b.removed = true;
    }

    // æ¸…é™¤å‡ºç•Œ
    const before = activeBirds.length;
    activeBirds = activeBirds.filter(b => {
      if (!b.removed) return true;
      try { b.el.remove(); } catch(e){}
      return false;
    });

    // å¦‚æœé³¥éƒ½é£›èµ°äº†é‚„æ²’ç­”é¡Œï¼šæç¤ºä¸¦é‡ç”Ÿ
    if (!locked && activeBirds.length === 0 && before > 0) {
      setFeedback("warn", "æç¤º", "ä½ æ²’æ‰“åˆ°ä»»ä½•é³¥ï¼Œå†çµ¦ä½ ä¸€æ¬¡ï¼ˆæ…¢æ…¢ä¾†ï¼‰ï¼");
      spawnRound();
      return;
    }

    rafId = requestAnimationFrame(loop);
  }

  // é»ä¸­é³¥
  function onHit(b) {
    if (locked) return;
    locked = true;

    const q = QUESTIONS[qIndex];
    const correct = (b.flow === q.answerFlow);

    if (correct) {
      score += 10;
      streak += 1;
      setFeedback("good", "âœ” æ­£ç¢º", `ä½ é¸çš„æ˜¯ã€Œ${FLOW_LABEL[b.flow]}ã€ã€‚${q.explain}`);
    } else {
      score = Math.max(0, score - 5);
      streak = 0;
      const rightLabel = FLOW_LABEL[q.answerFlow];
      setFeedback("bad", "âœ˜ éŒ¯èª¤", `æ­£ç¢ºæ‡‰è©²æ˜¯ã€Œ${rightLabel}ã€ã€‚åŸå› ï¼š${q.explain}`);
    }

    scoreEl.textContent = String(score);
    streakEl.textContent = String(streak);

    // è®“ç©å®¶çœ‹å®Œè§£é‡‹ï¼Œå†è‡ªå‹•ä¸‹ä¸€é¡Œ
    setTimeout(() => {
      nextQuestion();
    }, 1200);
  }

  function nextQuestion() {
    qIndex = (qIndex + 1) % QUESTIONS.length;
    spawnRound();
  }

  function resetAll() {
    qIndex = 0;
    score = 0;
    streak = 0;
    scoreEl.textContent = "0";
    streakEl.textContent = "0";
    qNoEl.textContent = "1";
    setFeedback("warn", "æç¤º", "å·²é‡ä¾†ã€‚æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚");
    clearBirds();
    qText.textContent = "æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚";
    hintLine.textContent = "ï¼ˆæ‰“éŒ¯ä¹Ÿæ²’é—œä¿‚ï¼Œæˆ‘æœƒå‘Šè¨´ä½ ç‚ºä»€éº¼ï¼‰";
    locked = false;
  }

  // Buttons
  btnNext.addEventListener("click", () => {
    // ç¬¬ä¸€æ¬¡æŒ‰ï¼šå¾ç¬¬ 0 é¡Œé–‹å§‹
    spawnRound();
  });
  btnReset.addEventListener("click", resetAll);

  // æ”¹é€Ÿåº¦/é›£åº¦ï¼šä¸‹ä¸€å›åˆç”Ÿæ•ˆï¼ˆé¿å…ä¸­é€”äº‚è·³ï¼‰
  speedEl.addEventListener("input", () => {
    setFeedback("warn", "æç¤º", `é€Ÿåº¦å·²èª¿æ•´ï¼š${speedEl.value}ï¼ˆä¸‹ä¸€é¡Œç”Ÿæ•ˆï¼‰`);
  });
  levelEl.addEventListener("change", () => {
    setFeedback("warn", "æç¤º", `é›£åº¦å·²åˆ‡æ›ï¼š${levelEl.options[levelEl.selectedIndex].text}ï¼ˆä¸‹ä¸€é¡Œç”Ÿæ•ˆï¼‰`);
  });

  // åˆå§‹
  resetAll();
})();
</script>
</body>
</html>
