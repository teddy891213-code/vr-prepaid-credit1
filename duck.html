<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
<title>VR æ‰“é³¥å­¸æ”¯ä»˜æµç¨‹ï½œå„²å€¼å¡ vs ä¿¡ç”¨å¡</title>

<style>
html,body{
  margin:0;height:100%;background:#050c14;color:#eef2ff;
  font-family:system-ui,-apple-system,"Noto Sans TC";
}
*{box-sizing:border-box}
#app{position:fixed;inset:0;display:flex;flex-direction:column}
header,footer{
  padding:10px;
  background:rgba(0,0,0,.55);
  border-bottom:1px solid rgba(255,255,255,.12);
  display:flex;flex-wrap:wrap;gap:10px;align-items:center
}
footer{border-top:1px solid rgba(255,255,255,.12);border-bottom:none}
button{
  background:rgba(255,255,255,.08);
  color:#eef2ff;border:1px solid rgba(255,255,255,.18);
  border-radius:12px;padding:8px 12px;font-size:14px
}
#stage{flex:1;position:relative;overflow:hidden}
canvas{width:100%;height:100%;display:block}

.overlay{
  position:absolute;inset:0;
  background:rgba(0,0,0,.4);
  display:flex;align-items:center;justify-content:center
}
.card{
  background:rgba(0,0,0,.75);
  border:1px solid rgba(255,255,255,.18);
  border-radius:16px;
  padding:16px;
  width:min(90%,760px)
}
.card h3{margin:0 0 8px;font-size:18px}
.card p{margin:6px 0;color:#cfd6ff}

.pill{padding:6px 10px;border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.12);font-size:13px}

#reticle{
  position:absolute;left:50%;top:50%;
  width:22px;height:22px;pointer-events:none;
  transform:translate(-50%,-50%);
  border:2px solid rgba(255,255,255,.9);
  border-radius:50%;
}
#reticle:before,#reticle:after{
  content:"";position:absolute;background:#fff
}
#reticle:before{width:2px;height:12px;left:50%;top:5px;transform:translateX(-50%)}
#reticle:after{height:2px;width:12px;top:50%;left:5px;transform:translateY(-50%)}
</style>
</head>

<body>
<div id="app">
<header>
  <span class="pill">VR æ‰“é³¥å­¸æ”¯ä»˜æµç¨‹</span>
  <button id="btnFull">å…¨è¢å¹•</button>
  <button id="btnRecenter">é‡æ–°æ ¡æ­£</button>
</header>

<div id="stage">
  <canvas id="c"></canvas>
  <div id="reticle"></div>

  <!-- æ¨¡å¼é¸æ“‡ -->
  <div class="overlay" id="modeOverlay">
    <div class="card">
      <h3>é¸æ“‡ç„æº–æ–¹å¼</h3>
      <p>å·¦çœ‹ï¼é™€èºå„€ç„æº–ï¼ˆæ¨è–¦ï¼‰<br>å³çœ‹ï¼ä¸­å¤®æº–æ˜Ÿï¼ˆå…æˆæ¬Šï¼‰</p>
      <p>ğŸ‘‰ ç”¨é ­å°æº–å¾Œã€Œé»ä¸€ä¸‹ã€é¸æ“‡</p>
    </div>
  </div>
</div>

<footer>
  <span class="pill" id="hint">ç”¨é ­è½‰å‹•ç„æº–ï¼Œé»ä¸€ä¸‹å°„æ“Š</span>
</footer>
</div>

<script>
/* ========= åŸºæœ¬è¨­å®š ========= */
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const stage = document.getElementById("stage");
const reticle = document.getElementById("reticle");
const hint = document.getElementById("hint");

let W,H;
function resize(){
  W = canvas.width = stage.clientWidth * devicePixelRatio;
  H = canvas.height = stage.clientHeight * devicePixelRatio;
  ctx.setTransform(devicePixelRatio,0,0,devicePixelRatio,0,0);
}
window.addEventListener("resize",resize);
resize();

/* ========= é¡Œåº«ï¼ˆç´ é¤Šå°å‘ã€äººè©±ï¼‰ ========= */
const QUESTIONS = [
{
 q:"ä½ å¸³æˆ¶è£¡å…¶å¯¦æ²’éŒ¢ï¼Œä½†é‚„æ˜¯èƒ½å…ˆè²·æ±è¥¿ï¼Œä¸‹å€‹æœˆå†ä»˜éŒ¢ï¼Œé€™ä»£è¡¨ä»€éº¼ç‰¹æ€§ï¼Ÿ",
 correct:"å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾",
 opts:["å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾","éœ€è¦å…ˆå„²å€¼","èŠ±å¤šå°‘ç«‹åˆ»æ‰£å¤šå°‘","åªèƒ½ç”¨å¡å…§é¤˜é¡"]
},
{
 q:"å¦‚æœä½ å¸Œæœ›ã€æœ€å¤šåªèƒ½èŠ±åˆ°ä½ å…ˆæ”¾é€²å»çš„é‡‘é¡ã€ï¼Œä½ è¦çš„æ˜¯å“ªä¸€ç¨®ç‰¹æ€§ï¼Ÿ",
 correct:"èŠ±è²»ä¸Šé™ç­‰æ–¼å·²å„²å€¼é‡‘é¡",
 opts:["èŠ±è²»ä¸Šé™ç­‰æ–¼å·²å„²å€¼é‡‘é¡","å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾","æœ‰å¸³å–®æ—¥","éŠ€è¡Œå…ˆå¢Šæ¬¾"]
},
{
 q:"ä½ åˆ·å®Œå¡ç«‹åˆ»çœ‹åˆ°é¤˜é¡è®Šå°‘ï¼Œé€™æ˜¯åœ¨å¼·èª¿å“ªä¸€ä»¶äº‹ï¼Ÿ",
 correct:"å³æ™‚æ‰£æ¬¾",
 opts:["å³æ™‚æ‰£æ¬¾","æœˆåº•çµå¸³","éŠ€è¡Œå¢Šæ¬¾","ä¿¡ç”¨é¡åº¦"]
}
];

/* ========= ç‹€æ…‹ ========= */
let idx=0;
let birds=[];
let running=false;
let aimMode=null; // gyro | center
let aim={x:.5,y:.5};
let neutral=null;

/* ========= è¢å¹•æ—‹è½‰ä¿®æ­£ ========= */
function screenAngle(){
  const a = screen.orientation?.angle ?? window.orientation ?? 0;
  return ((a%360)+360)%360;
}

/* ========= é™€èºå„€ ========= */
window.addEventListener("deviceorientation",e=>{
  if(aimMode!=="gyro")return;
  if(!neutral)neutral={b:e.beta,g:e.gamma};
  let db=e.beta-neutral.b;
  let dg=e.gamma-neutral.g;

  let dx=dg,dy=db;
  const ang=screenAngle();
  if(ang===90){[dx,dy]=[dy,-dx]}
  if(ang===270){[dx,dy]=[-dy,dx]}

  aim.x=Math.min(.97,Math.max(.03,.5+dx/80));
  aim.y=Math.min(.97,Math.max(.03,.5+dy/80));
});

/* ========= é³¥ ========= */
function spawn(){
  birds=[];
  const q=QUESTIONS[idx];
  const opts=[...q.opts].sort(()=>Math.random()-.5);
  opts.forEach((t,i)=>{
    birds.push({
      t,
      ok:t===q.correct,
      x:Math.random(),
      y:Math.random(),
      vx:(Math.random()-.5)*.25,
      vy:(Math.random()-.5)*.25
    });
  });
}

/* ========= ç•«é¢ ========= */
function draw(){
  ctx.clearRect(0,0,W,H);
  const half=W/2;
  birds.forEach(b=>{
    b.x+=b.vx*0.016;
    b.y+=b.vy*0.016;
    if(b.x<0||b.x>1)b.vx*=-1;
    if(b.y<0||b.y>1)b.vy*=-1;

    ctx.fillStyle=b.ok?"rgba(80,220,160,.8)":"rgba(255,120,120,.8)";
    ctx.fillRect(b.x*W/2,b.y*H,220,60);
    ctx.fillRect(half+b.x*W/2,b.y*H,220,60);
    ctx.fillStyle="#000";
    ctx.font="16px sans-serif";
    ctx.fillText(b.t,b.x*W/2+10,b.y*H+36);
    ctx.fillText(b.t,half+b.x*W/2+10,b.y*H+36);
  });
  requestAnimationFrame(draw);
}
draw();

/* ========= å°„æ“Š ========= */
stage.addEventListener("pointerdown",()=>{
  if(!aimMode){
    aimMode = aim.x<.5 ? "gyro" : "center";
    document.getElementById("modeOverlay").style.display="none";
    hint.textContent="ç”¨é ­è½‰å‹•ç„æº–ï¼Œé»ä¸€ä¸‹å°„æ“Š";
    spawn();running=true;
    return;
  }
  if(!running)return;
  for(const b of birds){
    if(aim.x>b.x && aim.x<b.x+.2 && aim.y>b.y && aim.y<b.y+.12){
      hint.textContent=b.ok?"âœ… æ­£ç¢º":"âŒ å†æƒ³æƒ³";
      idx=(idx+1)%QUESTIONS.length;
      spawn();
      break;
    }
  }
});

/* ========= å…¨è¢å¹• ========= */
document.getElementById("btnFull").onclick=()=>{
  stage.requestFullscreen?.();
};

/* ========= æ ¡æ­£ ========= */
document.getElementById("btnRecenter").onclick=()=>neutral=null;
</script>
</body>
</html>
