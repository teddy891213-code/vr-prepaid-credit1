<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>2D æ‰“é³¥å­¸æµç¨‹ï¼šå„²å€¼å¡ vs ä¿¡ç”¨å¡ï¼ˆé ­ç„æº–ï¼‹é»æ“Šå°„æ“Šï¼‰</title>
  <style>
    :root{
      --bg:#061018;
      --panel: rgba(0,0,0,.55);
      --panel2: rgba(255,255,255,.06);
      --line: rgba(255,255,255,.14);
      --txt:#eaf2ff;
      --muted:#b7c3da;
      --good:#46d38a;
      --bad:#ff6868;
      --warn:#ffd26a;
      --accent:#7bd6ff;
      --accent2:#bda7ff;
    }
    html,body{height:100%;margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,"Noto Sans TC","Segoe UI",Roboto,Arial;}
    *{box-sizing:border-box;}
    #wrap{height:100%;display:grid;grid-template-rows:auto auto 1fr auto;gap:10px;padding:10px;}

    header{
      display:flex;flex-wrap:wrap;gap:10px;align-items:center;
      padding:10px 12px;border:1px solid var(--line);
      background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,0));
      border-radius:14px;
    }
    .title{
      font-weight:900; letter-spacing:.2px;
      display:flex; align-items:center; gap:10px;
      white-space:nowrap;
    }
    .title .dot{width:10px;height:10px;border-radius:50%;background:var(--accent);box-shadow:0 0 18px rgba(123,214,255,.35);}
    .pill{
      padding:6px 10px;border-radius:999px;
      background:var(--panel2); border:1px solid var(--line);
      font-size:13px;color:var(--muted); white-space:nowrap;
    }
    .spacer{flex:1}
    .ctrl{display:flex;gap:10px;align-items:center;flex-wrap:wrap;}
    label{font-size:13px;color:var(--muted);display:flex;gap:8px;align-items:center;}
    input[type=range]{width:180px;}
    select,button{
      background:rgba(0,0,0,.35); color:var(--txt);
      border:1px solid var(--line); border-radius:10px;
      padding:8px 10px; font-size:14px;
      cursor:pointer;
    }
    button:hover{border-color:rgba(255,255,255,.28)}
    button.primary{border-color:rgba(123,214,255,.5); box-shadow:0 0 18px rgba(123,214,255,.10);}
    button.danger{border-color:rgba(255,104,104,.45);}

    /* å•é¡Œå€ï¼ˆç½®ä¸­å¤§å¡ï¼‰ */
    #qBar{
      border:1px solid var(--line); border-radius:14px;
      background:var(--panel);
      padding:10px 12px;
      display:flex;flex-direction:column;gap:6px;
    }
    #qTopRow{
      display:flex;gap:10px;align-items:center;flex-wrap:wrap;
      color:var(--muted);font-size:13px;
    }
    .tag{
      background:rgba(255,255,255,.06);
      border:1px solid rgba(255,255,255,.12);
      border-radius:999px;
      padding:4px 10px;
      white-space:nowrap;
    }
    #qMain{
      font-size:18px;
      line-height:1.35;
      font-weight:800;
      letter-spacing:.1px;
      color:var(--txt);
    }
    #qMini{
      color:var(--muted);
      font-size:14px;
      line-height:1.3;
    }

    /* éŠæˆ²å€ */
    #game{
      position:relative;
      overflow:hidden;
      border-radius:16px;
      border:1px solid var(--line);
      background:
        radial-gradient(900px 500px at 20% 20%, rgba(123,214,255,.10), transparent 55%),
        radial-gradient(900px 500px at 80% 10%, rgba(189,167,255,.10), transparent 55%),
        radial-gradient(900px 700px at 50% 120%, rgba(123,214,255,.08), transparent 60%),
        #061018;
      touch-action:manipulation;
      cursor:crosshair;
      min-height:420px;
    }

    /* æº–æ˜Ÿï¼ˆVR é ­ç„æº–ï¼šå›ºå®šæ­£ä¸­å¤®ï¼‰ */
    #reticle{
      position:absolute; left:50%; top:50%;
      width:18px; height:18px;
      transform:translate(-50%,-50%);
      pointer-events:none;
      border:2px solid rgba(255,255,255,.85);
      border-radius:999px;
      box-shadow:0 0 0 6px rgba(123,214,255,.14), 0 0 24px rgba(123,214,255,.18);
      z-index:20;
    }
    #reticle:before, #reticle:after{
      content:""; position:absolute; left:50%; top:50%;
      width:2px; height:10px; background:rgba(255,255,255,.85);
      transform:translate(-50%,-50%);
    }
    #reticle:after{ width:10px; height:2px; }

    /* ä¸­å¤®é¡Œç›®å¡ï¼ˆå…ˆè®€é¡Œ 5 ç§’ï¼‰ */
    #centerCard{
      position:absolute; left:50%; top:50%;
      transform:translate(-50%,-50%);
      width:min(760px, 92%);
      background:rgba(0,0,0,.58);
      border:1px solid rgba(255,255,255,.14);
      border-radius:16px;
      padding:14px 14px 12px;
      box-shadow:0 20px 70px rgba(0,0,0,.45);
      z-index:30;
    }
    #centerHeadline{
      display:flex; align-items:center; justify-content:space-between;
      gap:10px; flex-wrap:wrap;
      margin-bottom:8px;
    }
    #centerHeadline .h{
      font-weight:900; font-size:16px;
      display:flex; gap:8px; align-items:center;
    }
    #centerHeadline .h .pin{
      width:10px;height:10px;border-radius:50%;
      background:var(--warn);
      box-shadow:0 0 16px rgba(255,210,106,.25);
    }
    #countLabel{color:var(--muted); font-size:13px;}
    #centerQ{
      font-size:18px; font-weight:900; line-height:1.35;
      margin:6px 0 10px;
    }
    #centerHint{
      color:var(--muted);
      font-size:14px; line-height:1.3;
    }
    #countBar{
      height:10px; border-radius:999px; overflow:hidden;
      border:1px solid rgba(255,255,255,.14);
      background:rgba(255,255,255,.06);
      margin-top:10px;
    }
    #countFill{
      height:100%;
      width:0%;
      background:linear-gradient(90deg, rgba(123,214,255,.9), rgba(189,167,255,.9));
    }

    /* é³¥ï¼ˆå¯é»æ“Šä½†æˆ‘å€‘ç”¨æº–æ˜Ÿä¸­å¿ƒåˆ¤å®šï¼‰ */
    .bird{
      position:absolute;
      width:220px;
      padding:10px 10px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background:rgba(0,0,0,.42);
      box-shadow:0 18px 55px rgba(0,0,0,.25);
      display:flex;
      gap:10px;
      align-items:center;
      user-select:none;
      transform:translateZ(0);
    }
    .bird .ico{
      width:42px;height:42px;border-radius:12px;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      display:grid; place-items:center;
      font-size:24px;
      flex:0 0 auto;
    }
    .bird .txt{min-width:0}
    .bird .opt{
      font-weight:900; font-size:16px; line-height:1.1;
      margin-bottom:3px;
    }
    .bird .sub{
      font-size:13px;
      color:var(--muted);
      line-height:1.25;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }

    .bird.good{ border-color:rgba(70,211,138,.35); box-shadow:0 22px 70px rgba(70,211,138,.06); }
    .bird.bad{ border-color:rgba(255,104,104,.35); box-shadow:0 22px 70px rgba(255,104,104,.06); }

    /* å°„æ“Šç‰¹æ•ˆ */
    .fx{
      position:absolute;
      width:10px;height:10px;border-radius:999px;
      pointer-events:none;
      transform:translate(-50%,-50%);
      z-index:40;
    }
    .fx:before{
      content:"";
      position:absolute; inset:-16px;
      border-radius:999px;
      border:2px solid rgba(123,214,255,.75);
      opacity:.95;
      transform:scale(.3);
      animation: ring .28s ease-out forwards;
    }
    .fx:after{
      content:"";
      position:absolute; inset:-6px;
      border-radius:999px;
      background:rgba(255,255,255,.85);
      filter:blur(.2px);
      opacity:.9;
      animation: flash .18s ease-out forwards;
    }
    @keyframes ring{
      to{ transform:scale(1); opacity:0; }
    }
    @keyframes flash{
      to{ transform:scale(1.6); opacity:0; }
    }
    .shake{ animation: shake .18s ease-in-out; }
    @keyframes shake{
      0%{transform:translate(0,0)}
      25%{transform:translate(-3px,1px)}
      50%{transform:translate(2px,-2px)}
      75%{transform:translate(-2px,-1px)}
      100%{transform:translate(0,0)}
    }

    /* åº•éƒ¨è¨Šæ¯ */
    #msg{
      border:1px solid var(--line); border-radius:14px;
      background:var(--panel);
      padding:10px 12px;
      display:flex; gap:10px; align-items:center; justify-content:space-between;
      color:var(--muted);
      font-size:14px;
    }
    #flashMsg{
      font-weight:900;
      color:var(--txt);
    }
    #flashMsg.ok{ color:var(--good); }
    #flashMsg.no{ color:var(--bad); }

    /* è®“é¸é …æ›´å¤§æ›´å¥½çœ‹ï¼ˆæ‰‹æ©Ÿä¹Ÿèƒ½çœ‹æ¸…æ¥šï¼‰ */
    @media (max-width: 720px){
      #qMain{font-size:16px}
      #centerQ{font-size:16px}
      .bird{width:210px}
      .bird .opt{font-size:15px}
    }
  </style>
</head>

<body>
<div id="wrap">
  <header>
    <div class="title"><span class="dot"></span>2D æ‰“é³¥å­¸æµç¨‹ï¼š<span style="color:var(--accent)">å„²å€¼å¡</span> vs <span style="color:var(--accent2)">ä¿¡ç”¨å¡</span></div>

    <div class="pill" id="statScore">åˆ†æ•¸ï¼š0</div>
    <div class="pill" id="statStreak">é€£å°ï¼š0</div>
    <div class="pill" id="statQ">é¡Œè™Ÿï¼š0/0</div>

    <div class="spacer"></div>

    <div class="ctrl">
      <label>é€Ÿåº¦
        <input id="speed" type="range" min="0.55" max="1.85" step="0.05" value="0.75" />
      </label>
      <label>é›£åº¦
        <select id="difficulty">
          <option value="easy">ä¸€èˆ¬</option>
          <option value="mid">é€²éš</option>
          <option value="hard">æŒ‘æˆ°</option>
        </select>
      </label>
      <button class="primary" id="btnStart">é–‹å§‹ / ä¸‹ä¸€é¡Œ</button>
      <button id="btnReset" class="danger">é‡ä¾†</button>
    </div>
  </header>

  <section id="qBar">
    <div id="qTopRow">
      <span class="tag" id="chipFocus">ç„¦é»ï¼šâ€”</span>
      <span class="tag" id="chipKey">é—œéµï¼šâ€”</span>
      <span class="tag" id="chipTrap">å¸¸è¦‹èª¤å€ï¼šâ€”</span>
    </div>
    <div id="qMain">æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚å…ˆè®€é¡Œ 5 ç§’ï¼Œå†é–‹å§‹æ‰“é³¥ã€‚</div>
    <div id="qMini">ç©æ³•ï¼šç”¨é ­ç„æº–ï¼ˆçœ‹æº–æ˜Ÿï¼‰ï¼Œé»ä¸€ä¸‹å°„æ“Šã€‚æ‰“ä¸­ã€Œç¬¦åˆé¡Œæ„çš„ç‰¹æ€§ã€é‚£éš»é³¥ã€‚</div>
  </section>

  <main id="game" aria-label="game">
    <div id="reticle" aria-hidden="true"></div>

    <div id="centerCard" style="display:none;">
      <div id="centerHeadline">
        <div class="h"><span class="pin"></span>å…ˆè®€é¡Œç›®</div>
        <div id="countLabel">æº–å‚™é–‹å§‹ï¼š5 ç§’</div>
      </div>
      <div id="centerQ">â€”</div>
      <div id="centerHint">â€”</div>
      <div id="countBar"><div id="countFill"></div></div>
    </div>
  </main>

  <footer id="msg">
    <div>æç¤ºï¼š<span id="hintText">â€”</span></div>
    <div id="flashMsg"> </div>
  </footer>
</div>

<script>
(() => {
  const game = document.getElementById('game');
  const centerCard = document.getElementById('centerCard');
  const centerQ = document.getElementById('centerQ');
  const centerHint = document.getElementById('centerHint');
  const countLabel = document.getElementById('countLabel');
  const countFill = document.getElementById('countFill');

  const qMain = document.getElementById('qMain');
  const qMini = document.getElementById('qMini');
  const hintText = document.getElementById('hintText');

  const statScore = document.getElementById('statScore');
  const statStreak = document.getElementById('statStreak');
  const statQ = document.getElementById('statQ');

  const chipFocus = document.getElementById('chipFocus');
  const chipKey = document.getElementById('chipKey');
  const chipTrap = document.getElementById('chipTrap');

  const speedEl = document.getElementById('speed');
  const diffEl = document.getElementById('difficulty');
  const btnStart = document.getElementById('btnStart');
  const btnReset = document.getElementById('btnReset');
  const flashMsg = document.getElementById('flashMsg');

  // ===== é¡Œåº«ï¼šæ¯é¡Œå•ã€Œæƒ…å¢ƒéœ€è¦çš„æ”¯ä»˜æµç¨‹ç‰¹æ€§ã€ =====
  // ä½ ä¸æ˜¯åœ¨é¸å¡åï¼Œè€Œæ˜¯åœ¨é¸ã€Œç‰¹æ€§ã€ï¼›æœ€å¾Œæ‰å›æ¨å¡åˆ¥ï¼ˆç´ é¤Šå°å‘ï¼‰
  // correctKey æ˜¯æ­£ç¢ºç‰¹æ€§ key
  const BANK = [
    {
      stem: "ä½ åœ¨éŠæˆ²è£¡æƒ³è²·é“å…·ï¼Œä½†ä½ å¸³æˆ¶é¤˜é¡ä¸å¤ ï¼›å¹³å°ä»è®“ä½ å…ˆè²·ï¼Œä¸‹å€‹æœˆå†ä¸€æ¬¡ç¹³æ¸…ã€‚é€™ç¨®æ”¯ä»˜æµç¨‹çš„æ ¸å¿ƒç‰¹æ€§æ˜¯ï¼Ÿ",
      focus: "æ”¯ä»˜æ™‚é»",
      key: "å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾",
      trap: "æŠŠã€å…ˆä»˜éŒ¢ã€èª¤ä»¥ç‚ºä¿¡ç”¨å¡",
      hint: "çœ‹èª°å…ˆï¼šå…ˆå¾—åˆ°å•†å“ï¼Ÿé‚„æ˜¯å…ˆä»˜éŒ¢ï¼Ÿ",
      correctKey: "payLater",
      opts: [
        { key:"payLater", label:"å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾", sub:"å…ˆå–å¾—å•†å“/æœå‹™ï¼Œä¹‹å¾Œæ‰åœ¨å¸³å–®æ—¥ä»˜æ¬¾", icon:"ğŸ•Šï¸" , kind:"credit"},
        { key:"payNow", label:"å…ˆä»˜æ¬¾å†æ¶ˆè²»", sub:"å…ˆæŠŠéŒ¢æ‰£æ‰/æ‰£é¤˜é¡ï¼Œæ‰å®Œæˆäº¤æ˜“", icon:"ğŸ¦" , kind:"prepaid"},
        { key:"limitLine", label:"æœ‰ä¿¡ç”¨é¡åº¦/æˆä¿¡", sub:"å¯è¶…éç¾æœ‰å­˜æ¬¾é¡åº¦ï¼Œä½†å—é™æ–¼é¡åº¦", icon:"ğŸ¦…" , kind:"credit"},
        { key:"topUp", label:"éœ€è¦å…ˆå„²å€¼", sub:"å…ˆæŠŠéŒ¢åŠ é€²å¡/éŒ¢åŒ…é¤˜é¡ï¼Œæ‰èƒ½ä½¿ç”¨", icon:"ğŸ¦œ" , kind:"prepaid"},
      ]
    },
    {
      stem: "ä½ æŠŠä¸€å¼µå¡äº¤çµ¦å®¶äººä»£è²·ï¼Œæœ€æ€•ã€åˆ·è¶…ã€ã€‚ä½ æƒ³è¦ä¸€ç¨®ã€Œæœ€å¤šåªèƒ½èŠ±åˆ°ä½ å…ˆæ”¾é€²å»çš„é‡‘é¡ã€çš„æ–¹å¼ã€‚ä½ éœ€è¦çš„ç‰¹æ€§æ˜¯ï¼Ÿ",
      focus: "é¢¨éšªæ§åˆ¶",
      key: "æ”¯å‡ºä¸Šé™ï¼å·²å„²å€¼é‡‘é¡",
      trap: "æŠŠã€é¡åº¦ã€å’Œã€å„²å€¼ã€æ··åœ¨ä¸€èµ·",
      hint: "ä½ è¦çš„æ˜¯ã€ä¸èƒ½è¶…æ”¯ã€çš„æ©Ÿåˆ¶ã€‚",
      correctKey: "capBalance",
      opts: [
        { key:"capBalance", label:"èŠ±è²»ä¸Šé™ï¼å¡å…§é¤˜é¡", sub:"æœ€å¤šåªèƒ½èŠ±åˆ°ä½ å…ˆæ”¾é€²å»çš„é‡‘é¡", icon:"ğŸ¤", kind:"prepaid"},
        { key:"billLater", label:"å…ˆåˆ·å¾Œç¹³ï¼ˆå¸³å–®ï¼‰", sub:"æœˆåº•/ä¸‹æœˆæ‰çµç®—ä»˜æ¬¾", icon:"ğŸ•Šï¸", kind:"credit"},
        { key:"interest", label:"å¯èƒ½æœ‰å¾ªç’°åˆ©æ¯", sub:"æ²’æœ‰ä¸€æ¬¡ç¹³æ¸…æ™‚ï¼Œå¯èƒ½ç”¢ç”Ÿåˆ©æ¯", icon:"ğŸ¦‰", kind:"credit"},
        { key:"chargeback", label:"çˆ­è­°æ¬¾ç”³è¨´/æ‹’ä»˜", sub:"æœ‰æ©Ÿæœƒç”³è«‹çˆ­è­°æ¬¾è™•ç†ï¼ˆè¦–è¦ç¯„ï¼‰", icon:"ğŸ¦¢", kind:"credit"},
      ]
    },
    {
      stem: "ä½ ç¶²è³¼æ”¶åˆ°ç‘•ç–µå“ï¼Œæƒ³ã€å…ˆæŠŠæ¬¾é …å¡ä½ã€ï¼Œç­‰çˆ­è­°è™•ç†å®Œå†æ±ºå®šæ˜¯å¦ä»˜æ¬¾ã€‚ä½ éœ€è¦çš„ç‰¹æ€§æ¯”è¼ƒåƒï¼Ÿ",
      focus: "äº¤æ˜“ä¿éšœ",
      key: "çˆ­è­°æ¬¾/æ‹’ä»˜ï¼ˆè¼ƒå¸¸è¦‹ï¼‰",
      trap: "ä»¥ç‚ºæ‰€æœ‰å¡éƒ½ä¸€æ¨£èƒ½æ‹’ä»˜",
      hint: "é‡é»ï¼šä»˜æ¬¾æ˜¯å¦å·²ç¶“çœŸçš„å¾ä½ æ‰‹ä¸Šæ‰£èµ°ï¼Ÿ",
      correctKey: "chargeback",
      opts: [
        { key:"chargeback", label:"å¯ç”³è«‹çˆ­è­°æ¬¾/æ‹’ä»˜", sub:"äº¤æ˜“çˆ­è­°æ™‚è¼ƒå¸¸è¦‹æœ‰æµç¨‹å¯ç”³è¨´", icon:"ğŸ¦¢", kind:"credit"},
        { key:"instantDeduct", label:"ä»˜æ¬¾å³æ™‚æ‰£é¤˜é¡", sub:"ä¸€åˆ·å°±ç›´æ¥æ‰£æ‰ä½ å¡å…§/éŒ¢åŒ…é‡‘é¡", icon:"ğŸ¦", kind:"prepaid"},
        { key:"topUp", label:"å…ˆå„²å€¼å†ç”¨", sub:"è¦å…ˆæŠŠéŒ¢æ”¾é€²å»ï¼Œæ‰èƒ½äº¤æ˜“", icon:"ğŸ¦œ", kind:"prepaid"},
        { key:"quota", label:"å—ä¿¡ç”¨é¡åº¦é™åˆ¶", sub:"å¯ç”¨é¡åº¦å…§å…ˆæ¶ˆè²»", icon:"ğŸ¦…", kind:"credit"},
      ]
    },
    {
      stem: "ä½ æƒ³åŸ¹é¤Šè¨˜å¸³ç¿’æ…£ï¼Œå¸Œæœ›æ¯æ¬¡èŠ±éŒ¢éƒ½ã€ç«‹åˆ»çœ‹åˆ°é¤˜é¡è®Šå°‘ã€ï¼Œé¿å…æœˆåº•æ‰é©šè¦ºçˆ†è²·ã€‚ä½ éœ€è¦çš„ç‰¹æ€§æ˜¯ï¼Ÿ",
      focus: "è²¡å‹™ç®¡ç†",
      key: "å³æ™‚æ‰£æ¬¾/é¤˜é¡å¯è¦–",
      trap: "æŠŠã€å¸³å–®ã€ç•¶æˆå³æ™‚æ‰£æ¬¾",
      hint: "çœ‹å¾—åˆ°ã€ç•¶ä¸‹ã€çš„æ”¯å‡ºå¾Œæœï¼Œæ‰å¥½æ§ç®¡ã€‚",
      correctKey: "instantDeduct",
      opts: [
        { key:"instantDeduct", label:"äº¤æ˜“å³æ™‚æ‰£é¤˜é¡", sub:"æ¯åˆ·ä¸€æ¬¡ï¼Œé¤˜é¡ç«‹åˆ»è®Šå°‘", icon:"ğŸ¤", kind:"prepaid"},
        { key:"statement", label:"æœˆåº•å¸³å–®çµç®—", sub:"é›†ä¸­åˆ°å¸³å–®æ—¥æ‰çµç®—ä»˜æ¬¾", icon:"ğŸ•Šï¸", kind:"credit"},
        { key:"interest", label:"æœªç¹³æ¸…å¯èƒ½æœ‰åˆ©æ¯", sub:"å¯èƒ½ç”¢ç”Ÿå¾ªç’°åˆ©æ¯", icon:"ğŸ¦‰", kind:"credit"},
        { key:"quota", label:"æœ‰ä¿¡ç”¨é¡åº¦", sub:"å¯è¶…éå­˜æ¬¾ä½†å—é¡åº¦é™åˆ¶", icon:"ğŸ¦…", kind:"credit"},
      ]
    },
    {
      stem: "ä½ åœ¨æ·é‹/æ ¡åœ’è²©è³£æ©Ÿæƒ³å¿«é€Ÿä»˜æ¬¾ï¼Œåå¥½ã€ä¸ç”¨æ ¸å°ç°½åã€ä¸ç”¨ç­‰å¸³å–®ã€ï¼Œä½†è¦å…ˆæŠŠéŒ¢æ”¾é€²å»ã€‚ä½ éœ€è¦çš„ç‰¹æ€§æ˜¯ï¼Ÿ",
      focus: "ä½¿ç”¨æƒ…å¢ƒ",
      key: "å…ˆå„²å€¼ï¼‹å¿«é€Ÿå°é¡",
      trap: "æŠŠã€å¿«ã€èª¤èªç‚ºä¿¡ç”¨å¡",
      hint: "é‡é»ï¼šå…ˆæŠŠéŒ¢æ”¾é€²å» â†’ æ‰èƒ½åˆ·ã€‚",
      correctKey: "topUp",
      opts: [
        { key:"topUp", label:"å…ˆå„²å€¼å†ä½¿ç”¨", sub:"å…ˆåŠ å€¼åˆ°å¡/éŒ¢åŒ…ï¼Œäº¤æ˜“æ™‚ç›´æ¥æ‰£é¤˜é¡", icon:"ğŸ¦œ", kind:"prepaid"},
        { key:"payLater", label:"å…ˆæ¶ˆè²»å¾Œä»˜æ¬¾", sub:"æœˆåº•æˆ–ä¸‹æœˆæ‰ä»˜æ¬¾", icon:"ğŸ•Šï¸", kind:"credit"},
        { key:"quota", label:"ä¿¡ç”¨é¡åº¦", sub:"å¯ç”¨é¡åº¦å…§å…ˆæ¶ˆè²»", icon:"ğŸ¦…", kind:"credit"},
        { key:"chargeback", label:"çˆ­è­°æ¬¾ç”³è¨´æµç¨‹", sub:"é‡åˆ°çˆ­è­°äº¤æ˜“å¯ä¾è¦ç¯„ç”³è¨´", icon:"ğŸ¦¢", kind:"credit"},
      ]
    }
  ];

  // ===== éŠæˆ²ç‹€æ…‹ =====
  let idx = 0;
  let score = 0;
  let streak = 0;
  let running = false;
  let locked = false;

  // é³¥åˆ—è¡¨ï¼ˆç”¨æ–¼æº–æ˜Ÿå‘½ä¸­åˆ¤å®šï¼‰
  let birds = []; // {el,x,y,w,h,vx,vy,isCorrect,optKey}

  // å‹•ç•«
  let rafId = 0;
  let lastT = 0;

  // ===== å·¥å…· =====
  const rand = (a,b)=> a + Math.random()*(b-a);
  const clamp = (v,a,b)=> Math.max(a, Math.min(b,v));

  function setHUD(){
    statScore.textContent = `åˆ†æ•¸ï¼š${score}`;
    statStreak.textContent = `é€£å°ï¼š${streak}`;
    statQ.textContent = `é¡Œè™Ÿï¼š${idx}/${BANK.length}`;
  }

  function flash(text, ok){
    flashMsg.textContent = text;
    flashMsg.className = ok ? "ok" : "no";
    setTimeout(()=>{ flashMsg.textContent=" "; flashMsg.className=""; }, 900);
  }

  function shotFX(x,y){
    const fx = document.createElement('div');
    fx.className = 'fx';
    fx.style.left = x + 'px';
    fx.style.top = y + 'px';
    game.appendChild(fx);
    game.classList.add('shake');
    setTimeout(()=>game.classList.remove('shake'), 220);
    setTimeout(()=>fx.remove(), 240);
  }

  // å–é€Ÿåº¦å€ç‡ï¼ˆé è¨­æ…¢ï¼‰
  function speedMul(){
    const base = parseFloat(speedEl.value || "0.75");
    // é›£åº¦å°é€Ÿåº¦åŠ æˆï¼ˆä»ä¿ç•™æ»‘æ¡¿ä¸»æ§ï¼‰
    const d = diffEl.value;
    const k = d==="easy" ? 0.95 : d==="mid" ? 1.05 : 1.18;
    return base * k;
  }

  // ===== é¡Œç›®å‘ˆç¾ï¼ˆå…ˆè®€ 5 ç§’ï¼‰ =====
  async function showCountdown(q){
    centerCard.style.display = '';
    centerQ.textContent = q.stem;
    centerHint.textContent = `æç¤ºï¼š${q.hint}`;
    qMain.textContent = q.stem;
    qMini.textContent = `æç¤ºï¼š${q.hint}`;

    chipFocus.textContent = `ç„¦é»ï¼š${q.focus}`;
    chipKey.textContent = `é—œéµï¼š${q.key}`;
    chipTrap.textContent = `å¸¸è¦‹èª¤å€ï¼š${q.trap}`;
    hintText.textContent = `çœ‹æº–æ˜Ÿï¼Œé»ä¸€ä¸‹å°„æ“Šã€‚æ‰¾å‡ºã€Œæœ€ç¬¦åˆé¡Œæ„çš„ç‰¹æ€§ã€ã€‚`;

    const total = 5.0;
    const start = performance.now();
    return new Promise(resolve=>{
      function tick(t){
        const s = (t - start)/1000;
        const left = Math.max(0, total - s);
        const pct = clamp((s/total)*100,0,100);
        countFill.style.width = pct + "%";
        countLabel.textContent = `æº–å‚™é–‹å§‹ï¼š${Math.ceil(left)} ç§’`;
        if(s >= total){
          centerCard.style.display = 'none';
          resolve();
        }else{
          requestAnimationFrame(tick);
        }
      }
      requestAnimationFrame(tick);
    });
  }

  // ===== ç”¢ç”Ÿé³¥ =====
  function clearBirds(){
    birds.forEach(b=> b.el.remove());
    birds = [];
  }

  function makeBird(opt, isCorrect){
    const el = document.createElement('div');
    el.className = 'bird ' + (isCorrect ? 'good' : 'bad');

    // å¤§å°æ›´æ¸…æ¥šï¼ˆé¸é …æ›´å¤§ï¼‰
    el.innerHTML = `
      <div class="ico">${opt.icon || "ğŸ¦"}</div>
      <div class="txt">
        <div class="opt">${opt.label}</div>
        <div class="sub">${opt.sub}</div>
      </div>
    `;

    // åˆå§‹ä½ç½®èˆ‡é€Ÿåº¦ï¼šæœƒä¸€ç›´é£›ï¼‹åå½ˆï¼ˆä¸æœƒåœåœ¨å®šé»ï¼‰
    const W = game.clientWidth;
    const H = game.clientHeight;

    const w = 220;
    const h = 74;

    // å¾å››å‘¨é€²å ´ï¼ˆæ¯”è¼ƒåƒã€Œé£›ä¾†ã€ï¼‰
    const side = Math.floor(rand(0,4));
    let x, y;
    if(side===0){ x = -w-10; y = rand(40, H-120); }          // å·¦
    else if(side===1){ x = W+10; y = rand(40, H-120); }      // å³
    else if(side===2){ x = rand(40, W-260); y = -h-10; }     // ä¸Š
    else { x = rand(40, W-260); y = H+10; }                  // ä¸‹

    // é€Ÿåº¦ï¼ˆéš¨æ©Ÿä½†å— speedMul æ§åˆ¶ï¼‰
    const sp = speedMul();
    const vx = (side===0 ? rand(90,150) : side===1 ? -rand(90,150) : rand(-140,140)) * sp;
    const vy = (side===2 ? rand(90,140) : side===3 ? -rand(90,140) : rand(-120,120)) * sp;

    el.style.left = x + "px";
    el.style.top  = y + "px";
    game.appendChild(el);

    const b = { el, x, y, w, h, vx, vy, isCorrect, optKey: opt.key };
    birds.push(b);
    // ä¸ä¾è³´é»é³¥ï¼Œä½†ä¿ç•™å¯é»ï¼ˆæ¡Œæ©Ÿä¹Ÿå¥½ç”¨ï¼‰
    el.addEventListener('pointerdown', (ev)=>{ ev.preventDefault(); if(!locked && running) onShoot(b); });
    return b;
  }

  function spawnRound(q){
    clearBirds();
    locked = false;
    running = true;

    // é¸é …æ•¸é‡ï¼šä¸€èˆ¬ 4ï¼›é€²éš 5ï¼›æŒ‘æˆ° 6ï¼ˆè®“ä½ è¦ºå¾—ä¸æ˜¯å…©å€‹é¸é …é‚£éº¼å–®èª¿ï¼‰
    const d = diffEl.value;
    const targetCount = d==="easy" ? 4 : d==="mid" ? 5 : 6;

    // å…ˆæŠŠé€™é¡Œçš„ opts æ‰“æ•£
    const pool = q.opts.slice().sort(()=>Math.random()-0.5);

    // æ‰¾å‡ºæ­£ç¢ºé¸é …ï¼Œç¢ºä¿ä¸€å®šå‡ºç¾
    const correct = pool.find(o=>o.key===q.correctKey) || q.opts.find(o=>o.key===q.correctKey);
    const rest = pool.filter(o=>o.key!==q.correctKey);

    // çµ„åˆï¼š1 æ­£ç¢º + (targetCount-1) å¹²æ“¾
    const chosen = [correct, ...rest.slice(0, Math.max(0, targetCount-1))].sort(()=>Math.random()-0.5);

    // ç”¢ç”Ÿé³¥
    chosen.forEach(opt=>{
      const isCorrect = opt.key === q.correctKey;
      makeBird(opt, isCorrect);
    });
  }

  // ===== å‘½ä¸­è™•ç† =====
  function onShoot(b){
    if(locked) return;
    locked = true;

    const ok = b.isCorrect;
    if(ok){
      score += 10;
      streak += 1;
      flash("âœ… æ‰“ä¸­ï¼ä¸‹ä¸€é¡Œ", true);
    }else{
      score = Math.max(0, score - 5);
      streak = 0;
      // å‘Šè¨´æ­£ç¢ºæ˜¯ä»€éº¼ï¼ˆä½†ä¸è¦ä¸€å¤§æ®µå»¢è©±ï¼‰
      const q = BANK[idx-1];
      const correct = q.opts.find(o=>o.key===q.correctKey);
      flash(`âŒ æ‰“éŒ¯ï¼æ­£ç¢ºï¼š${correct.label}`, false);
    }
    setHUD();

    // 0.9 ç§’å¾Œè‡ªå‹•é€²ä¸‹ä¸€é¡Œï¼ˆä½ ä¹Ÿå¯æŒ‰æŒ‰éˆ•ï¼‰
    setTimeout(()=> next(), 900);
  }

  // ===== ä¸»è¿´åœˆï¼šä¸€ç›´é£›ï¼‹åå½ˆ =====
  function loop(t){
    rafId = requestAnimationFrame(loop);
    if(!lastT) lastT = t;
    const dt = (t - lastT)/1000;
    lastT = t;

    if(!running) return;

    const W = game.clientWidth;
    const H = game.clientHeight;
    const sp = speedMul();

    for(const b of birds){
      // é€Ÿåº¦è·Ÿæ»‘æ¡¿åŒæ­¥ï¼ˆå³æ™‚èª¿ï¼‰
      const k = sp / (sp || 1);
      b.x += b.vx * dt;
      b.y += b.vy * dt;

      // åå½ˆé‚Šç•Œï¼ˆç•™é»å…§è·ï¼Œé¿å…å¤ªè²¼é‚Šï¼‰
      const pad = 18;
      if(b.x < -b.w - 30) b.x = W + 10;
      if(b.x > W + 30)    b.x = -b.w - 10;
      if(b.y < -b.h - 30) b.y = H + 10;
      if(b.y > H + 30)    b.y = -b.h - 10;

      // å°å¹…åº¦æ“¾å‹•ï¼ˆçœ‹èµ·ä¾†æ›´åƒé£›è¡Œï¼Œä¸æ˜¯ç›´ç·šæœ¨é ­ï¼‰
      b.vx += rand(-18,18) * dt * (diffEl.value==="hard" ? 1.2 : 0.9);
      b.vy += rand(-18,18) * dt * (diffEl.value==="hard" ? 1.2 : 0.9);

      // é™é€Ÿé¿å…å¤ªèª‡å¼µ
      const maxV = (diffEl.value==="easy" ? 220 : diffEl.value==="mid" ? 260 : 300) * parseFloat(speedEl.value);
      b.vx = clamp(b.vx, -maxV, maxV);
      b.vy = clamp(b.vy, -maxV, maxV);

      b.el.style.left = b.x + "px";
      b.el.style.top  = b.y + "px";
    }
  }

  // ===== VR ç„æº–ï¼‹é»æ“Šå°„æ“Šï¼šæ°¸é å°„æ­£ä¸­å¤® =====
  game.addEventListener("pointerdown", (e)=>{
    const rect = game.getBoundingClientRect();

    // ç”¨é ­ç„æº–ï¼šæº–æ˜Ÿå›ºå®šæ­£ä¸­å¤®
    const x = rect.width / 2;
    const y = rect.height / 2;

    shotFX(x,y);

    if(locked || !running) return;

    // å‘½ä¸­åˆ¤å®šï¼šæº–æ˜Ÿä¸­å¿ƒè½åœ¨å“ªéš»é³¥æ¡†å…§
    for(let i = birds.length - 1; i >= 0; i--){
      const b = birds[i];
      if(x >= b.x && x <= b.x + b.w && y >= b.y && y <= b.y + b.h){
        onShoot(b);
        break;
      }
    }
  });

  // ===== æ§åˆ¶ï¼šé–‹å§‹/ä¸‹ä¸€é¡Œã€é‡ä¾† =====
  async function next(){
    running = false;
    clearBirds();

    if(idx >= BANK.length){
      qMain.textContent = `çµæŸï¼ä½ çš„åˆ†æ•¸ï¼š${score}ï¼ˆé€£å°æœ€é«˜å¯ç¹¼çºŒåˆ·é¡Œï¼‰`;
      qMini.textContent = `å¯æŒ‰ã€Œé‡ä¾†ã€å†ç·´ä¸€æ¬¡ã€‚`;
      centerCard.style.display = 'none';
      hintText.textContent = "å®Œæˆã€‚";
      return;
    }

    idx += 1;
    setHUD();

    const q = BANK[idx-1];
    await showCountdown(q);
    spawnRound(q);
  }

  function reset(){
    idx = 0; score = 0; streak = 0;
    locked = false; running = false;
    clearBirds();
    setHUD();
    qMain.textContent = "æŒ‰ã€Œé–‹å§‹ / ä¸‹ä¸€é¡Œã€é–‹å§‹ã€‚å…ˆè®€é¡Œ 5 ç§’ï¼Œå†é–‹å§‹æ‰“é³¥ã€‚";
    qMini.textContent = "ç©æ³•ï¼šç”¨é ­ç„æº–ï¼ˆçœ‹æº–æ˜Ÿï¼‰ï¼Œé»ä¸€ä¸‹å°„æ“Šã€‚æ‰“ä¸­ã€Œç¬¦åˆé¡Œæ„çš„ç‰¹æ€§ã€é‚£éš»é³¥ã€‚";
    chipFocus.textContent = "ç„¦é»ï¼šâ€”";
    chipKey.textContent = "é—œéµï¼šâ€”";
    chipTrap.textContent = "å¸¸è¦‹èª¤å€ï¼šâ€”";
    hintText.textContent = "â€”";
    centerCard.style.display = 'none';
  }

  btnStart.addEventListener('click', ()=>{
    if(!rafId) rafId = requestAnimationFrame(loop);
    next();
  });

  btnReset.addEventListener('click', ()=>{
    reset();
  });

  // åˆå§‹åŒ–
  setHUD();
  reset();
})();
</script>
</body>
</html>
